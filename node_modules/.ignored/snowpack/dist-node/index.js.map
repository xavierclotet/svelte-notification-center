{"version":3,"file":"index.js","sources":["../dist-src/util.js","../dist-src/rewrite-imports.js","../dist-src/stats-formatter.js","../dist-src/commands/build-util.js","../dist-src/commands/esbuildPlugin.js","../dist-src/commands/src-file-extension-mapping.js","../dist-src/commands/import-resolver.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugins/rollup-plugin-catch-unresolved.js","../dist-src/rollup-plugins/rollup-plugin-catch-fetch.js","../dist-src/rollup-plugins/rollup-plugin-css.js","../dist-src/rollup-plugins/rollup-plugin-entrypoint-alias.js","../dist-src/rollup-plugins/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugins/rollup-plugin-stats.js","../dist-src/rollup-plugins/rollup-plugin-wrap-install-targets.js","../dist-src/scan-imports.js","../dist-src/commands/install.js","../dist-src/commands/paint.js","../dist-src/commands/build.js","../dist-src/hmr-server-engine.js","../dist-src/commands/dev.js","../dist-src/commands/add-rm.js","../dist-src/config.js","../dist-src/index.js"],"sourcesContent":["import rimraf from 'rimraf';\nimport cacache from 'cacache';\nimport globalCacheDir from 'cachedir';\nimport etag from 'etag';\nimport execa from 'execa';\nimport projectCacheDir from 'find-cache-dir';\nimport findUp from 'find-up';\nimport fs from 'fs';\nimport got from 'got';\nimport open from 'open';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const GLOBAL_CACHE_DIR = globalCacheDir('snowpack');\nexport const RESOURCE_CACHE = path.join(GLOBAL_CACHE_DIR, 'pkg-cache-1.4');\nexport const BUILD_CACHE = path.join(GLOBAL_CACHE_DIR, 'build-cache-1.4');\nexport const PROJECT_CACHE_DIR = projectCacheDir({ name: 'snowpack' });\nexport const DEV_DEPENDENCIES_DIR = path.join(PROJECT_CACHE_DIR, 'dev');\nconst LOCKFILE_HASH_FILE = '.hash';\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\n// NOTE(fks): Must match empty script elements to work properly.\nexport const HTML_JS_REGEX = /(<script.*?>)(.*?)<\\/script>/gms;\nexport function isYarn(cwd) {\n    return fs.existsSync(path.join(cwd, 'yarn.lock'));\n}\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf8' });\n}\nexport function fetchCDNResource(resourceUrl, responseType) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    // @ts-ignore - TS doesn't like responseType being unknown amount three options\n    return got(resourceUrl, {\n        responseType: responseType,\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/** Get the package name + an entrypoint within that package (if given). */\nexport function parsePackageImportSpecifier(imp) {\n    const impParts = imp.split('/');\n    if (imp.startsWith('@')) {\n        const [scope, name, ...rest] = impParts;\n        return [`${scope}/${name}`, rest.join('/') || null];\n    }\n    const [name, ...rest] = impParts;\n    return [name, rest.join('/') || null];\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifest location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        // if its an export map issue, move on to our manual resolver.\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n            return [null, null];\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\nconst appNames = {\n    win32: {\n        brave: 'brave',\n        chrome: 'chrome',\n    },\n    darwin: {\n        brave: 'Brave Browser',\n        chrome: 'Google Chrome',\n    },\n    linux: {\n        brave: 'brave',\n        chrome: 'google-chrome',\n    },\n};\nexport async function openInBrowser(protocol, port, browser) {\n    const url = `${protocol}//localhost:${port}`;\n    browser = /chrome/i.test(browser)\n        ? appNames[process.platform]['chrome']\n        : /brave/i.test(browser)\n            ? appNames[process.platform]['brave']\n            : browser;\n    if (process.platform === 'darwin' && /chrome|default/i.test(browser)) {\n        // If we're on macOS, and we haven't requested a specific browser,\n        // we can try opening Chrome with AppleScript. This lets us reuse an\n        // existing tab when possible instead of creating a new one.\n        try {\n            await execa.command('ps cax | grep \"Google Chrome\"', {\n                shell: true,\n            });\n            await execa('osascript ../assets/openChrome.applescript \"' + encodeURI(url) + '\"', {\n                cwd: __dirname,\n                stdio: 'ignore',\n                shell: true,\n            });\n            return true;\n        }\n        catch (err) {\n            // If macOS auto-reuse doesn't work, just open normally, using default browser.\n            open(url);\n        }\n    }\n    else {\n        browser === 'default' ? open(url) : open(url, { app: browser });\n    }\n}\nexport async function checkLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return true;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc, 'utf-8'));\n    const oldLockHash = await fs.promises.readFile(hashLoc, 'utf-8').catch(() => '');\n    return newLockHash === oldLockHash;\n}\nexport async function updateLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc));\n    await mkdirp(path.dirname(hashLoc));\n    await fs.promises.writeFile(hashLoc, newLockHash);\n}\nexport async function clearCache() {\n    return Promise.all([\n        cacache.rm.all(RESOURCE_CACHE),\n        cacache.rm.all(BUILD_CACHE),\n        rimraf.sync(PROJECT_CACHE_DIR),\n    ]);\n}\n/**\n * Given an import string and a list of scripts, return the mount script that matches the import.\n *\n * `mount ./src --to /_dist_` and `mount src --to /_dist_` match `src/components/Button`\n * `mount src --to /_dist_` does not match `package/components/Button`\n */\nexport function findMatchingMountScript(scripts, spec) {\n    // Only match bare module specifiers. relative and absolute imports should not match\n    if (spec.startsWith('./') ||\n        spec.startsWith('../') ||\n        spec.startsWith('/') ||\n        spec.startsWith('http://') ||\n        spec.startsWith('https://')) {\n        return null;\n    }\n    return scripts\n        .filter((script) => script.type === 'mount')\n        .find(({ args }) => spec.startsWith(args.fromDisk));\n}\n/** Get full extensions of files */\nexport function getExt(fileName) {\n    return {\n        /** base extension (e.g. `.js`) */\n        baseExt: path.extname(fileName).toLocaleLowerCase(),\n        /** full extension, if applicable (e.g. `.proxy.js`) */\n        expandedExt: path.basename(fileName).replace(/[^.]+/, '').toLocaleLowerCase(),\n    };\n}\n","import { HTML_JS_REGEX } from './util';\nconst { parse } = require('es-module-lexer');\nfunction spliceString(source, withSlice, start, end) {\n    return source.slice(0, start) + (withSlice || '') + source.slice(end);\n}\nexport async function scanCodeImportsExports(code) {\n    const [imports] = await parse(code);\n    return imports.filter((imp) => {\n        //imp.d = -2 = import.meta.url = we can skip this for now\n        if (imp.d === -2) {\n            return false;\n        }\n        // imp.d > -1 === dynamic import\n        if (imp.d > -1) {\n            const importStatement = code.substring(imp.s, imp.e);\n            const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n            return !!importSpecifierMatch;\n        }\n        return true;\n    });\n}\nexport async function transformEsmImports(_code, replaceImport) {\n    const imports = await scanCodeImportsExports(_code);\n    let rewrittenCode = _code;\n    for (const imp of imports.reverse()) {\n        let spec = rewrittenCode.substring(imp.s, imp.e);\n        if (imp.d > -1) {\n            const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n            spec = importSpecifierMatch[1];\n        }\n        let rewrittenImport = replaceImport(spec);\n        if (imp.d > -1) {\n            rewrittenImport = JSON.stringify(rewrittenImport);\n        }\n        rewrittenCode = spliceString(rewrittenCode, rewrittenImport, imp.s, imp.e);\n    }\n    return rewrittenCode;\n}\nasync function transformHtmlImports(code, replaceImport) {\n    let rewrittenCode = code;\n    let match;\n    const importRegex = new RegExp(HTML_JS_REGEX);\n    while ((match = importRegex.exec(rewrittenCode))) {\n        const [, scriptTag, scriptCode] = match;\n        // Only transform a script element if it contains inlined code / is not empty.\n        if (scriptCode.trim()) {\n            rewrittenCode = spliceString(rewrittenCode, await transformEsmImports(scriptCode, replaceImport), match.index + scriptTag.length, match.index + scriptTag.length + scriptCode.length);\n        }\n    }\n    return rewrittenCode;\n}\nexport async function transformFileImports({ baseExt, code }, replaceImport) {\n    if (baseExt === '.js') {\n        return transformEsmImports(code, replaceImport);\n    }\n    if (baseExt === '.html') {\n        return transformHtmlImports(code, replaceImport);\n    }\n    throw new Error(`Incompatible filetype: cannot scan ${baseExt} files for ESM imports. This is most likely an error within Snowpack.`);\n}\n","import * as colors from 'kleur/colors';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return colors[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return colors[color](`Δ ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = colors.dim(isLastFile ? '└─' : '├─');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = colors.dim('[') + formatDelta(stats.delta) + colors.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  ⦿ ${colors.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            colors.bold(colors.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            '  ' +\n            colors.bold(colors.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            '  ' +\n            colors.bold(colors.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  ⦿ ${colors.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import execa from 'execa';\nimport npmRunPath from 'npm-run-path';\nconst IS_PREACT = /from\\s+['\"]preact['\"]/;\nexport function checkIsPreact(filePath, contents) {\n    return filePath.endsWith('.jsx') && IS_PREACT.test(contents);\n}\nexport function wrapImportMeta({ code, hmr, env, config: { buildOptions }, }) {\n    if (!code.includes('import.meta')) {\n        return code;\n    }\n    return ((hmr\n        ? `import * as  __SNOWPACK_HMR__ from '/${buildOptions.metaDir}/hmr.js';\\nimport.meta.hot = __SNOWPACK_HMR__.createHotContext(import.meta.url);\\n`\n        : ``) +\n        (env\n            ? `import __SNOWPACK_ENV__ from '/${buildOptions.metaDir}/env.js';\\nimport.meta.env = __SNOWPACK_ENV__;\\n`\n            : ``) +\n        '\\n' +\n        code);\n}\nlet _cssModuleLoader;\nexport async function wrapCssModuleResponse({ url, code, hasHmr = false, config: { buildOptions }, }) {\n    _cssModuleLoader = _cssModuleLoader || new (require('css-modules-loader-core'))();\n    const { injectableSource, exportTokens } = await _cssModuleLoader.load(code, url, undefined, () => {\n        throw new Error('Imports in CSS Modules are not yet supported.');\n    });\n    return `${hasHmr\n        ? `\nimport * as __SNOWPACK_HMR_API__ from '/${buildOptions.metaDir}/hmr.js';\nimport.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\nimport.meta.hot.accept(({module}) => {\n  code = module.code;\n  json = module.default;\n});\nimport.meta.hot.dispose(() => {\n  document.head.removeChild(styleEl);\n});\\n`\n        : ``}\nexport let code = ${JSON.stringify(injectableSource)};\nlet json = ${JSON.stringify(exportTokens)};\nexport default json;\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n}\nexport function wrapHtmlResponse({ code, hasHmr = false, buildOptions, }) {\n    // replace %PUBLIC_URL% in HTML files (along with surrounding slashes, if any)\n    code = code.replace(/\\/?%PUBLIC_URL%\\/?/g, '/');\n    if (hasHmr) {\n        code += `<script type=\"module\" src=\"/${buildOptions.metaDir}/hmr.js\"></script>`;\n    }\n    return code;\n}\nexport function wrapEsmProxyResponse({ url, code, ext, hasHmr = false, config: { buildOptions }, }) {\n    if (ext === '.json') {\n        return `${hasHmr\n            ? `\n    import * as __SNOWPACK_HMR_API__ from '/${buildOptions.metaDir}/hmr.js';\n    import.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\n    import.meta.hot.accept(({module}) => {\n      json = module.default;\n    });`\n            : ''}\nlet json = ${JSON.stringify(JSON.parse(code))};\nexport default json;`;\n    }\n    if (ext === '.css') {\n        return `${hasHmr\n            ? `\nimport * as __SNOWPACK_HMR_API__ from '/${buildOptions.metaDir}/hmr.js';\nimport.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\nimport.meta.hot.accept();\nimport.meta.hot.dispose(() => {\n  document.head.removeChild(styleEl);\n});\\n`\n            : ''}\nconst code = ${JSON.stringify(code)};\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n    }\n    return `export default ${JSON.stringify(url)};`;\n}\nexport function getFileBuilderForWorker(cwd, selectedWorker, messageBus) {\n    const { id, type, cmd, plugin } = selectedWorker;\n    if (type !== 'build') {\n        throw new Error(`scripts[${id}] is not a build script.`);\n    }\n    if (plugin?.build) {\n        const buildFn = plugin.build;\n        return async (args) => {\n            try {\n                const result = await buildFn(args);\n                return result;\n            }\n            catch (err) {\n                messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.message });\n                messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                return null;\n            }\n        };\n    }\n    return async ({ contents, filePath }) => {\n        let cmdWithFile = cmd.replace('$FILE', filePath);\n        try {\n            const { stdout, stderr } = await execa.command(cmdWithFile, {\n                env: npmRunPath.env(),\n                extendEnv: true,\n                shell: true,\n                input: contents,\n                cwd,\n            });\n            if (stderr) {\n                messageBus.emit('WORKER_MSG', { id, level: 'warn', msg: `${filePath}\\n${stderr}` });\n            }\n            return { result: stdout };\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: `${filePath}\\n${err.stderr}` });\n            messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n            return null;\n        }\n    };\n}\nconst PUBLIC_ENV_REGEX = /^SNOWPACK_PUBLIC_/;\nexport function generateEnvModule(mode) {\n    const envObject = { ...process.env };\n    for (const env of Object.keys(envObject)) {\n        if (!PUBLIC_ENV_REGEX.test(env)) {\n            delete envObject[env];\n        }\n    }\n    envObject.MODE = mode;\n    envObject.NODE_ENV = mode;\n    return `export default ${JSON.stringify(envObject)};`;\n}\n","import { startService } from 'esbuild';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport { checkIsPreact } from './build-util';\nlet esbuildService = null;\nexport function esbuildPlugin() {\n    return {\n        async build({ contents, filePath }) {\n            esbuildService = esbuildService || (await startService());\n            const isPreact = checkIsPreact(filePath, contents);\n            const { js, warnings } = await esbuildService.transform(contents, {\n                loader: path.extname(filePath).substr(1),\n                jsxFactory: isPreact ? 'h' : undefined,\n                jsxFragment: isPreact ? 'Fragment' : undefined,\n            });\n            for (const warning of warnings) {\n                console.error(colors.bold('! ') + filePath);\n                console.error('  ' + warning.text);\n            }\n            return { result: js || '' };\n        },\n    };\n}\nexport function stopEsbuild() {\n    esbuildService && esbuildService.stop();\n}\n","export default {\n    '.mjs': '.js',\n    '.jsx': '.js',\n    '.ts': '.js',\n    '.tsx': '.js',\n    '.vue': '.js',\n    '.svelte': '.js',\n    '.mdx': '.js',\n    '.svx': '.js',\n    '.elm': '.js',\n    '.yaml': '.json',\n    '.toml': '.json',\n    '.php': '.html',\n    '.md': '.html',\n    '.ejs': '.html',\n    '.njk': '.html',\n    '.scss': '.css',\n    '.sass': '.css',\n    '.less': '.css',\n};\n","import { statSync } from 'fs';\nimport path from 'path';\nimport { findMatchingMountScript, getExt } from '../util';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nconst cwd = process.cwd();\nconst URL_HAS_PROTOCOL_REGEX = /^(\\w+:)?\\/\\//;\n/** Perform a file disk lookup for the requested import specifier. */\nexport function getImportStats(dirLoc, spec) {\n    const importedFileOnDisk = path.resolve(dirLoc, spec);\n    try {\n        return statSync(importedFileOnDisk);\n    }\n    catch (err) {\n        // file doesn't exist, that's fine\n    }\n    return false;\n}\n/** Resolve an import based on the state of the file/folder found on disk. */\nfunction resolveSourceSpecifier(spec, stats, isBundled) {\n    if (stats && stats.isDirectory()) {\n        const trailingSlash = spec.endsWith('/') ? '' : '/';\n        spec = spec + trailingSlash + 'index.js';\n    }\n    else if (!stats && !spec.endsWith('.js') && !spec.endsWith('.css')) {\n        spec = spec + '.js';\n    }\n    const { baseExt } = getExt(spec);\n    const extToReplace = srcFileExtensionMapping[baseExt];\n    if (extToReplace) {\n        spec = spec.replace(new RegExp(`\\\\${baseExt}$`), extToReplace);\n    }\n    if (!isBundled && (extToReplace || baseExt) !== '.js') {\n        spec = spec + '.proxy.js';\n    }\n    return spec;\n}\n/**\n * Create a import resolver function, which converts any import relative to the given file at \"fileLoc\"\n * to a proper URL. Returns false if no matching import was found, which usually indicates a package\n * not found in the import map.\n */\nexport function createImportResolver({ fileLoc, webModulesPath, dependencyImportMap, isDev, isBundled, config, }) {\n    return function importResolver(spec) {\n        if (URL_HAS_PROTOCOL_REGEX.test(spec)) {\n            return spec;\n        }\n        let mountScript = findMatchingMountScript(config.scripts, spec);\n        if (mountScript) {\n            let { fromDisk, toUrl } = mountScript.args;\n            const importStats = getImportStats(cwd, spec);\n            spec = resolveSourceSpecifier(spec, importStats, isBundled);\n            spec = spec.replace(fromDisk, toUrl);\n            return spec;\n        }\n        if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n            const importStats = getImportStats(path.dirname(fileLoc), spec);\n            spec = resolveSourceSpecifier(spec, importStats, isBundled);\n            return spec;\n        }\n        if (dependencyImportMap && dependencyImportMap.imports[spec]) {\n            // if baseURL is remote, handle that outside of path.posix.join()\n            const protocolMatch = config.buildOptions.baseUrl.match(URL_HAS_PROTOCOL_REGEX);\n            const protocol = (protocolMatch && protocolMatch[0]) || '';\n            const baseUrl = config.buildOptions.baseUrl.replace(URL_HAS_PROTOCOL_REGEX, '');\n            let resolvedImport = isDev\n                ? path.posix.resolve(webModulesPath, dependencyImportMap.imports[spec])\n                : `${protocol}${path.posix.join(baseUrl, webModulesPath, dependencyImportMap.imports[spec])}`;\n            const extName = path.extname(resolvedImport);\n            if (!isBundled && extName && extName !== '.js') {\n                resolvedImport = resolvedImport + '.proxy.js';\n            }\n            return resolvedImport;\n        }\n        return false;\n    };\n}\n","import cacache from 'cacache';\nimport * as colors from 'kleur/colors';\nimport PQueue from 'p-queue';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    const typesUrlPath = headers['x-typescript-types'];\n    const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        console.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        console.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    console.log(colors.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        throw new Error('X-Import-URL header expected, but none received.');\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        throw new Error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(lockfile, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    for (const [installSpecifier, installSemver] of Object.entries(config.webDependencies)) {\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\n","import isNodeBuiltin from 'is-builtin-module';\n/**\n * rollup-plugin-catch-unresolved\n *\n * Catch any unresolved imports to give proper warnings (Rollup default is to ignore).\n */\nexport function rollupPluginCatchUnresolved() {\n    return {\n        name: 'snowpack:rollup-plugin-catch-unresolved',\n        resolveId(id, importer) {\n            if (isNodeBuiltin(id)) {\n                this.warn({\n                    id: importer,\n                    message: `\"${id}\" (Node.js built-in) could not be resolved. (https://www.snowpack.dev/#node-built-in-could-not-be-resolved)`,\n                });\n            }\n            else {\n                this.warn({\n                    id: importer,\n                    message: `\"${id}\" could not be resolved. (Is it installed?)`,\n                });\n            }\n            return false;\n        },\n    };\n}\n","const FETCH_POLYFILL = `\n// native patch for: node-fetch, whatwg-fetch\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n  if (typeof self !== 'undefined') { return self; }\n  if (typeof window !== 'undefined') { return window; }\n  if (typeof global !== 'undefined') { return global; }\n  throw new Error('unable to locate global object');\n}\nvar global = getGlobal();\nexport default global.fetch.bind(global);\nexport const Headers = global.Headers;\nexport const Request = global.Request;\nexport const Response = global.Response;\n`;\n/**\n * rollup-plugin-catch-fetch\n *\n * How it works: NPM packages will sometimes contain Node.js-specific polyfills\n * for the native browser Fetch API. Since this makes no sense in an ESM web\n * project, we can replace these expensive polyfills with native references to\n * the fetch API.\n *\n * This still allows you to polyfill fetch in older browsers, if you desire.\n */\nexport function rollupPluginCatchFetch() {\n    return {\n        name: 'snowpack:fetch-handler',\n        resolveId(id) {\n            if (id !== 'node-fetch' && id !== 'whatwg-fetch') {\n                return null;\n            }\n            return id;\n        },\n        load(id) {\n            if (id !== 'node-fetch' && id !== 'whatwg-fetch') {\n                return null;\n            }\n            return FETCH_POLYFILL;\n        },\n    };\n}\n","import { promises as fs } from 'fs';\nfunction getInjectorCode(name, code) {\n    return `\n/** SNOWPACK INJECT STYLE: ${name} */\nfunction __snowpack__injectStyle(css) {\n  const headEl = document.head || document.getElementsByTagName('head')[0];\n  const styleEl = document.createElement('style');\n  styleEl.type = 'text/css';\n  if (styleEl.styleSheet) {\n    styleEl.styleSheet.cssText = css;\n  } else {\n    styleEl.appendChild(document.createTextNode(css));\n  }\n  headEl.appendChild(styleEl);\n}\n__snowpack__injectStyle(${JSON.stringify(code)});\\n`;\n}\n/**\n * rollup-plugin-css\n *\n * Support installing any imported CSS into your dependencies. This isn't strictly valid\n * ESM code, but it is popular in the npm ecosystem & web development ecosystems. It also\n * solves a problem that is difficult to solve otherwise (referencing CSS from JS) so for\n * those reasons we have added default support for importing CSS into Snowpack v2.\n */\nexport function rollupPluginCss() {\n    return {\n        name: 'snowpack:rollup-plugin-css',\n        resolveId(source, importer) {\n            if (!source.endsWith('.css')) {\n                return null;\n            }\n            return this.resolve(source, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n        async load(id) {\n            if (!id.endsWith('.css')) {\n                return null;\n            }\n            const code = await fs.readFile(id, { encoding: 'utf8' });\n            const humanReadableName = id.replace(/.*node_modules[\\/\\\\]/, '').replace(/[\\/\\\\]/g, '/');\n            return getInjectorCode(humanReadableName, code);\n        },\n    };\n}\n","import path from 'path';\nimport { resolveDependencyManifest } from '../util';\nconst IS_DEEP_PACKAGE_IMPORT = /^(@[\\w-]+\\/)?([\\w-]+)\\/(.*)/;\n/**\n * rollup-plugin-entrypoint-alias\n *\n * Aliases any deep imports from a package to the package name, so that\n * chunking can happen more accurately.\n *\n * Example: lit-element imports from both 'lit-html' & 'lit-html/lit-html.js'.\n * Even though both eventually resolve to the same place, without this plugin\n * we lose the ability to mark \"lit-html\" as an external package.\n */\nexport function rollupPluginEntrypointAlias({ cwd }) {\n    return {\n        name: 'snowpack:rollup-plugin-entrypoint-alias',\n        resolveId(source, importer) {\n            if (!IS_DEEP_PACKAGE_IMPORT.test(source)) {\n                return null;\n            }\n            const [, packageScope, packageName] = source.match(IS_DEEP_PACKAGE_IMPORT);\n            const packageFullName = packageScope ? `${packageScope}${packageName}` : packageName;\n            let manifest;\n            try {\n                const [, _manifest] = resolveDependencyManifest(packageFullName, cwd);\n                manifest = _manifest;\n            }\n            catch (err) {\n                return null;\n            }\n            if (!manifest) {\n                return null;\n            }\n            let needsAlias = (typeof manifest.module === 'string' &&\n                source === path.posix.join(packageFullName, manifest.module)) ||\n                (typeof manifest.browser === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.browser)) ||\n                (typeof manifest.main === 'string' &&\n                    source === path.posix.join(packageFullName, manifest.main));\n            if (!needsAlias) {\n                return null;\n            }\n            return this.resolve(packageFullName, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n    };\n}\n","import fs from 'fs';\nimport cacache from 'cacache';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\nimport tar from 'tar';\nimport url from 'url';\nimport { fetchCDNResource, HAS_CDN_HASH_REGEX, PIKA_CDN, RESOURCE_CACHE } from '../util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ installTypes, log, }) {\n    const allTypesToInstall = new Set();\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDN path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                const typesUrlPath = response.headers['x-typescript-types'];\n                const pinnedUrlPath = response.headers['x-pinned-url'];\n                const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n                const pinnedUrl = pinnedUrlPath && `${PIKA_CDN}${pinnedUrlPath}`;\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body, {\n                    metadata: { pinnedUrl, typesUrl },\n                });\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locally instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            const typesUrl = cachedResult.metadata?.typesUrl;\n            if (typesUrl && installTypes) {\n                const typesTarballUrl = typesUrl.replace(/(mode=types.*?)\\/.*/, '$1/all.tgz');\n                allTypesToInstall.add(typesTarballUrl);\n            }\n            return cachedResult.data.toString('utf8');\n        },\n        async writeBundle(options) {\n            if (!installTypes) {\n                return;\n            }\n            await mkdirp(path.join(options.dir, '.types'));\n            const tempDir = await cacache.tmp.mkdir(RESOURCE_CACHE);\n            for (const typesTarballUrl of allTypesToInstall) {\n                let tarballContents;\n                const cachedTarball = await cacache\n                    .get(RESOURCE_CACHE, typesTarballUrl)\n                    .catch(( /* ignore */) => null);\n                if (cachedTarball) {\n                    tarballContents = cachedTarball.data;\n                }\n                else {\n                    const tarballResponse = await fetchCDNResource(typesTarballUrl, 'buffer');\n                    if (tarballResponse.statusCode !== 200) {\n                        continue;\n                    }\n                    tarballContents = tarballResponse.body;\n                    await cacache.put(RESOURCE_CACHE, typesTarballUrl, tarballContents);\n                }\n                const typesUrlParts = url.parse(typesTarballUrl).pathname.split('/');\n                const typesPackageName = url.parse(typesTarballUrl).pathname.startsWith('/-/@')\n                    ? typesUrlParts[2] + '/' + typesUrlParts[3].split('@')[0]\n                    : typesUrlParts[2].split('@')[0];\n                const typesPackageTarLoc = path.join(tempDir, `${typesPackageName}.tgz`);\n                if (typesPackageName.includes('/')) {\n                    await mkdirp(path.dirname(typesPackageTarLoc));\n                }\n                fs.writeFileSync(typesPackageTarLoc, tarballContents);\n                const typesPackageLoc = path.join(options.dir, `.types/${typesPackageName}`);\n                await mkdirp(typesPackageLoc);\n                await tar.x({\n                    file: typesPackageTarLoc,\n                    cwd: typesPackageLoc,\n                });\n            }\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync ? zlib.brotliCompressSync(contents).byteLength : 0,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        name: 'snowpack:rollup-plugin-stats',\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(_, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import * as colors from 'kleur/colors';\nimport path from 'path';\nfunction autoDetectExports(fileLoc) {\n    try {\n        return Object.keys(require(fileLoc));\n    }\n    catch (err) {\n        console.error(colors.red(`✘ Could not auto-detect exports for ${colors.bold(fileLoc)}\\n${err.message}`));\n    }\n}\n/**\n * rollup-plugin-wrap-install-targets\n *\n * How it works:\n * 1. An array of \"install targets\" are passed in, describing all known imports + metadata.\n * 2. If isTreeshake: Known imports are marked for tree-shaking by appending 'snowpack-wrap:' to the input value.\n * 3. If autoDetectPackageExports match: Also mark for wrapping, and use automatic export detection.\n * 4. On load, we return a false virtual file for all \"snowpack-wrap:\" inputs.\n *    a. That virtual file contains only `export ... from 'ACTUAL_FILE_PATH';` exports\n *    b. Rollup uses those exports to drive its tree-shaking algorithm.\n *    c. Rollup uses those exports to inform its \"namedExports\" for Common.js entrypoints.\n */\nexport function rollupPluginWrapInstallTargets(isTreeshake, autoDetectPackageExports, installTargets) {\n    const installTargetsByFile = {};\n    function isAutoDetect(normalizedFileLoc) {\n        return autoDetectPackageExports.some((p) => normalizedFileLoc.includes(`node_modules/${p}${p.endsWith('index.js') ? '' : '/'}`));\n    }\n    return {\n        name: 'snowpack:wrap-install-targets',\n        // Mark some inputs for tree-shaking.\n        options(inputOptions) {\n            const input = inputOptions.input;\n            for (const [key, val] of Object.entries(input)) {\n                installTargetsByFile[val] = installTargets.filter((imp) => imp.specifier === key);\n                if (isTreeshake &&\n                    installTargetsByFile[val].length > 0 &&\n                    !installTargetsByFile[val].some((imp) => imp.namespace || imp.all)) {\n                    input[key] = `snowpack-wrap:${val}`;\n                }\n                if (!isTreeshake) {\n                    const normalizedFileLoc = val.split(path.win32.sep).join(path.posix.sep);\n                    if (isAutoDetect(normalizedFileLoc)) {\n                        input[key] = `snowpack-wrap:${val}`;\n                    }\n                }\n            }\n            return inputOptions;\n        },\n        resolveId(source) {\n            if (source.startsWith('snowpack-wrap:')) {\n                return source;\n            }\n            return null;\n        },\n        load(id) {\n            if (!id.startsWith('snowpack-wrap:')) {\n                return null;\n            }\n            const fileLoc = id.substring('snowpack-wrap:'.length);\n            // Reduce all install targets into a single \"summarized\" install target.\n            const treeshakeSummary = installTargetsByFile[fileLoc].reduce((summary, imp) => {\n                summary.default = summary.default || imp.default;\n                summary.namespace = summary.namespace || imp.namespace;\n                summary.named = [...summary.named, ...imp.named];\n                return summary;\n            });\n            let uniqueNamedImports = Array.from(new Set(treeshakeSummary.named));\n            const normalizedFileLoc = fileLoc.split(path.win32.sep).join(path.posix.sep);\n            if (!isTreeshake && isAutoDetect(normalizedFileLoc)) {\n                uniqueNamedImports = autoDetectExports(fileLoc) || uniqueNamedImports;\n            }\n            const result = `\n        ${treeshakeSummary.namespace ? `export * from '${normalizedFileLoc}';` : ''}\n        ${treeshakeSummary.default\n                ? `import __pika_web_default_export_for_treeshaking__ from '${normalizedFileLoc}'; export default __pika_web_default_export_for_treeshaking__;`\n                : ''}\n        ${`export {${uniqueNamedImports.join(',')}} from '${normalizedFileLoc}';`}\n      `;\n            return result;\n        },\n    };\n}\n","import { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport fs from 'fs';\nimport glob from 'glob';\nimport * as colors from 'kleur/colors';\nimport mime from 'mime-types';\nimport nodePath from 'path';\nimport stripComments from 'strip-comments';\nimport validatePackageName from 'validate-npm-package-name';\nimport { isTruthy, findMatchingMountScript, HTML_JS_REGEX, getExt } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst ESM_IMPORT_REGEX = /import(?:[\"'\\s]*([\\w*${}\\n\\r\\t, ]+)\\s*from\\s*)?\\s*[\"'](.*?)[\"']/gm;\nconst ESM_DYNAMIC_IMPORT_REGEX = /import\\((?:['\"].+['\"]|`[^$]+`)\\)/gm;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst SPLIT_NAMED_IMPORTS_REGEX = /\\bas\\s+\\w+|,/s;\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    // import.meta: we can ignore\n    if (imp.d === -2) {\n        return null;\n    }\n    // Static imports: easy to parse\n    if (imp.d === -1) {\n        return code.substring(imp.s, imp.e);\n    }\n    // Dynamic imports: a bit trickier to parse. Today, we only support string literals.\n    const importStatement = code.substring(imp.s, imp.e);\n    const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n    return importSpecifierMatch ? importSpecifierMatch[1] : null;\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    if (!specifier) {\n        return null;\n    }\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the “.js”\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    if (/^import\\s+type/.test(importStatement)) {\n        return null;\n    }\n    const isDynamicImport = imp.d > -1;\n    const hasDefaultImport = !isDynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const hasNamespaceImport = !isDynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(SPLIT_NAMED_IMPORTS_REGEX)\n        .map((name) => name.trim())\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: isDynamicImport || (!hasDefaultImport && !hasNamespaceImport && namedImports.length === 0),\n        default: hasDefaultImport,\n        namespace: hasNamespaceImport,\n        named: namedImports,\n    };\n}\nfunction cleanCodeForParsing(code) {\n    code = stripComments(code);\n    const allMatches = [];\n    let match;\n    const importRegex = new RegExp(ESM_IMPORT_REGEX);\n    while ((match = importRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    const dynamicImportRegex = new RegExp(ESM_DYNAMIC_IMPORT_REGEX);\n    while ((match = dynamicImportRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    return allMatches.map(([full]) => full).join('\\n');\n}\nfunction parseCodeForInstallTargets({ locOnDisk, baseExt, code, }) {\n    let imports;\n    // Attempt #1: Parse the file as JavaScript. JSX and some decorator\n    // syntax will break this.\n    try {\n        if (baseExt === '.jsx' || baseExt === '.tsx') {\n            // We know ahead of time that this will almost certainly fail.\n            // Just jump right to the secondary attempt.\n            throw new Error('JSX must be cleaned before parsing');\n        }\n        [imports] = parse(code) || [];\n    }\n    catch (err) {\n        // Attempt #2: Parse only the import statements themselves.\n        // This lets us guarentee we aren't sending any broken syntax to our parser,\n        // but at the expense of possible false +/- caused by our regex extractor.\n        try {\n            code = cleanCodeForParsing(code);\n            [imports] = parse(code) || [];\n        }\n        catch (err) {\n            // Another error! No hope left, just abort.\n            console.error(colors.red(`! ${locOnDisk}`));\n            throw err;\n        }\n    }\n    const allImports = imports\n        .map((imp) => parseImportStatement(code, imp))\n        .filter(isTruthy)\n        // Babel macros are not install targets!\n        .filter((imp) => !/[./]macro(\\.js)?$/.test(imp.specifier));\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports(cwd, config) {\n    await initESModuleLexer;\n    const includeFileSets = await Promise.all(config.scripts.map(({ type, args }) => {\n        if (type !== 'mount') {\n            return [];\n        }\n        if (args.fromDisk.includes('web_modules')) {\n            return [];\n        }\n        const dirDisk = nodePath.resolve(cwd, args.fromDisk);\n        return glob.sync(`**/*`, {\n            ignore: config.exclude.concat(['**/web_modules/**/*']),\n            cwd: dirDisk,\n            absolute: true,\n            nodir: true,\n        });\n    }));\n    const includeFiles = Array.from(new Set([].concat.apply([], includeFileSets)));\n    if (includeFiles.length === 0) {\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        const { baseExt, expandedExt } = getExt(filePath);\n        // Always ignore dotfiles\n        if (filePath.startsWith('.')) {\n            return null;\n        }\n        switch (baseExt) {\n            // Probably a license, a README, etc\n            case '': {\n                return null;\n            }\n            // Our import scanner can handle normal JS & even TypeScript without a problem.\n            case '.js':\n            case '.jsx':\n            case '.mjs':\n            case '.ts':\n            case '.tsx': {\n                return {\n                    baseExt,\n                    expandedExt,\n                    locOnDisk: filePath,\n                    code: await fs.promises.readFile(filePath, 'utf-8'),\n                };\n            }\n            case '.html':\n            case '.vue':\n            case '.svelte': {\n                const result = await fs.promises.readFile(filePath, 'utf-8');\n                // TODO: Replace with matchAll once Node v10 is out of TLS.\n                // const allMatches = [...result.matchAll(new RegExp(HTML_JS_REGEX))];\n                const allMatches = [];\n                let match;\n                const regex = new RegExp(HTML_JS_REGEX);\n                while ((match = regex.exec(result))) {\n                    allMatches.push(match);\n                }\n                return {\n                    baseExt,\n                    expandedExt,\n                    locOnDisk: filePath,\n                    // match[2] is the code inside the <script></script> element\n                    code: allMatches\n                        .map((match) => match[2])\n                        .filter((s) => s.trim())\n                        .join('\\n'),\n                };\n            }\n        }\n        // If we don't recognize the file type, it could be source. Warn just in case.\n        if (!mime.lookup(baseExt)) {\n            console.warn(colors.dim(`ignoring unsupported file \"${nodePath.relative(process.cwd(), filePath)}\"`));\n        }\n        return null;\n    }));\n    return scanImportsFromFiles(loadedFiles.filter(isTruthy), config);\n}\nexport async function scanImportsFromFiles(loadedFiles, { scripts }) {\n    return (loadedFiles\n        .map(parseCodeForInstallTargets)\n        .reduce((flat, item) => flat.concat(item), [])\n        // Ignore source imports that match a mount directory.\n        .filter((target) => !findMatchingMountScript(scripts, target.specifier))\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier)));\n}\n","import rollupPluginAlias from '@rollup/plugin-alias';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport { init as initESModuleLexer } from 'es-module-lexer';\nimport findUp from 'find-up';\nimport fs from 'fs';\nimport * as colors from 'kleur/colors';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport validatePackageName from 'validate-npm-package-name';\nimport { resolveTargetsFromRemoteCDN } from '../resolve-remote.js';\nimport { rollupPluginCatchUnresolved } from '../rollup-plugins/rollup-plugin-catch-unresolved.js';\nimport { rollupPluginCatchFetch } from '../rollup-plugins/rollup-plugin-catch-fetch';\nimport { rollupPluginCss } from '../rollup-plugins/rollup-plugin-css';\nimport { rollupPluginEntrypointAlias } from '../rollup-plugins/rollup-plugin-entrypoint-alias.js';\nimport { rollupPluginDependencyCache } from '../rollup-plugins/rollup-plugin-remote-cdn.js';\nimport { rollupPluginDependencyStats, } from '../rollup-plugins/rollup-plugin-stats.js';\nimport { rollupPluginWrapInstallTargets } from '../rollup-plugins/rollup-plugin-wrap-install-targets';\nimport { scanDepList, scanImports, scanImportsFromFiles } from '../scan-imports.js';\nimport { printStats } from '../stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, resolveDependencyManifest, writeLockfile, parsePackageImportSpecifier, } from '../util.js';\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add popular CJS packages here that use \"synthetic\" named imports in their documentation.\n// CJS packages should really only be imported via the default export:\n//   import React from 'react';\n// But, some large projects use named exports in their documentation:\n//   import {useState} from 'react';\n//\n// We use \"/index.js here to match the official package, but not any ESM aliase packages\n// that the user may have installed instead (ex: react-esm).\nconst CJS_PACKAGES_TO_AUTO_DETECT = [\n    'react/index.js',\n    'react-dom/index.js',\n    'react-is/index.js',\n    'prop-types/index.js',\n    'scheduler/index.js',\n    'react-table',\n];\nconst cwd = process.cwd();\nconst banner = colors.bold(`snowpack`) + ` installing... `;\nlet spinner;\nlet spinnerHasError = false;\nlet installResults = [];\nlet dependencyStats = null;\nfunction defaultLogError(msg) {\n    if (spinner && !spinnerHasError) {\n        spinner.stopAndPersist({ symbol: colors.cyan('⠼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(colors.red(msg));\n    spinner.fail();\n}\nfunction defaultLogUpdate(msg) {\n    spinner.text = banner + msg;\n}\nfunction formatInstallResults() {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return colors.green(d);\n        }\n        if (result === 'ASSET') {\n            return colors.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return colors.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\nfunction isImportOfPackage(importUrl, packageName) {\n    return packageName === importUrl || importUrl.startsWith(packageName + '/');\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\n/**\n * Takes object of env var mappings and converts it to actual\n * replacement specs as expected by @rollup/plugin-replace. The\n * `optimize` arg is used to derive NODE_ENV default.\n *\n * @param env\n * @param optimize\n */\nfunction getRollupReplaceKeys(env) {\n    const result = Object.keys(env).reduce((acc, id) => {\n        const val = env[id];\n        acc[`process.env.${id}`] = `${JSON.stringify(val === true ? process.env[id] : val)}`;\n        return acc;\n    }, {\n        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'production'),\n        'process.versions.node': 'undefined',\n        'process.platform': JSON.stringify('browser'),\n        'process.env.': '({}).',\n    });\n    return result;\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep) {\n    // if dep points directly to a file within a package, return that reference.\n    // No other lookup required.\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    // If dep is a path within a package (but without an extension), we first need\n    // to check for an export map in the package.json. If one exists, resolve to it.\n    const [packageName, packageEntrypoint] = parsePackageImportSpecifier(dep);\n    if (packageEntrypoint) {\n        const [packageManifestLoc, packageManifest] = resolveDependencyManifest(packageName, cwd);\n        if (packageManifestLoc && packageManifest && packageManifest.exports) {\n            const exportMapEntry = packageManifest.exports['./' + packageEntrypoint];\n            const exportMapValue = exportMapEntry?.browser ||\n                exportMapEntry?.import ||\n                exportMapEntry?.default ||\n                exportMapEntry?.require ||\n                exportMapEntry;\n            if (typeof exportMapValue !== 'string') {\n                throw new Error(`Package \"${packageName}\" exists but package.json \"exports\" does not include entry for \"./${packageEntrypoint}\".`);\n            }\n            return {\n                type: 'JS',\n                loc: path.join(packageManifestLoc, '..', exportMapValue),\n            };\n        }\n    }\n    // Otherwise, resolve directly to the dep specifier. Note that this supports both\n    // \"package-name\" & \"package-name/some/path\" where \"package-name/some/path/package.json\"\n    // exists at that lower path, that must be used to resolve. In that case, export\n    // maps should not be supported.\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        try {\n            const maybeLoc = require.resolve(dep, { paths: [cwd] });\n            return {\n                type: 'JS',\n                loc: maybeLoc,\n            };\n        }\n        catch (err) {\n            // Oh well, was worth a try\n        }\n    }\n    if (!depManifestLoc || !depManifest) {\n        throw new ErrorWithHint(`Package \"${dep}\" not found. Have you installed it?`, depManifestLoc ? colors.italic(depManifestLoc) : '');\n    }\n    if (depManifest.name &&\n        (depManifest.name.startsWith('@reactesm') || depManifest.name.startsWith('@pika/react'))) {\n        throw new Error(`React workaround packages no longer needed! Revert back to the official React & React-DOM packages.`);\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If browser object is set but no relevant entrypoint is found, fall back to \"main\".\n    if (!foundEntrypoint) {\n        foundEntrypoint = depManifest.main;\n    }\n    // Sometimes packages don't give an entrypoint, assuming you'll fall back to \"index.js\".\n    const isImplicitEntrypoint = !foundEntrypoint;\n    if (isImplicitEntrypoint) {\n        foundEntrypoint = 'index.js';\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    try {\n        return {\n            type: 'JS',\n            loc: require.resolve(path.join(depManifestLoc || '', '..', foundEntrypoint)),\n        };\n    }\n    catch (err) {\n        // Type only packages! Some packages are purely for TypeScript (ex: csstypes).\n        // If no JS entrypoint was given or found, but a TS \"types\"/\"typings\" entrypoint\n        // was given, assume a TS-types only package and ignore.\n        if (isImplicitEntrypoint && (depManifest.types || depManifest.typings)) {\n            return { type: 'IGNORE', loc: '' };\n        }\n        // Otherwise, file truly doesn't exist.\n        throw err;\n    }\n}\nconst FAILED_INSTALL_RETURN = {\n    success: false,\n    importMap: null,\n};\nexport async function install(installTargets, { lockfile, logError, logUpdate }, config) {\n    const { webDependencies, installOptions: { installTypes, dest: destLoc, externalPackage: externalPackages, alias: installAlias, sourceMap, env, rollup: userDefinedRollup, treeshake: isTreeshake, }, } = config;\n    const nodeModulesInstalled = findUp.sync('node_modules', { cwd, type: 'directory' });\n    if (!webDependencies && !process.versions.pnp && !nodeModulesInstalled) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return FAILED_INSTALL_RETURN;\n    }\n    const allInstallSpecifiers = new Set(installTargets\n        .filter((dep) => !externalPackages.some((packageName) => isImportOfPackage(dep.specifier, packageName)))\n        .map((dep) => dep.specifier)\n        .map((specifier) => installAlias[specifier] || specifier)\n        .sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = false;\n    const autoDetectNamedExports = [\n        ...CJS_PACKAGES_TO_AUTO_DETECT,\n        ...config.installOptions.namedExports,\n    ];\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${targetName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults());\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier);\n            if (targetType === 'JS') {\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}.js`;\n                Object.entries(installAlias)\n                    .filter(([, value]) => value === installSpecifier)\n                    .forEach(([key]) => {\n                    importMap.imports[key] = `./${targetName}.js`;\n                });\n                installTargetsMap[targetLoc] = installTargets.filter((t) => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${targetName}`;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults());\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults());\n            if (skipFailures) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return FAILED_INSTALL_RETURN;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(colors.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${colors.underline('https://www.pika.dev')}`));\n        return FAILED_INSTALL_RETURN;\n    }\n    await initESModuleLexer;\n    let isCircularImportFound = false;\n    const inputOptions = {\n        input: installEntrypoints,\n        external: (id) => externalPackages.some((packageName) => isImportOfPackage(id, packageName)),\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            rollupPluginReplace(getRollupReplaceKeys(env)),\n            rollupPluginEntrypointAlias({ cwd }),\n            !!webDependencies &&\n                rollupPluginDependencyCache({\n                    installTypes,\n                    log: (url) => logUpdate(colors.dim(url)),\n                }),\n            rollupPluginAlias({\n                entries: Object.entries(installAlias).map(([alias, mod]) => ({\n                    find: alias,\n                    replacement: mod,\n                })),\n            }),\n            rollupPluginCatchFetch(),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', 'main'].filter(isTruthy),\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: true,\n                dedupe: userDefinedRollup.dedupe,\n            }),\n            rollupPluginJson({\n                preferConst: true,\n                indent: '  ',\n                compact: false,\n                namedExports: true,\n            }),\n            rollupPluginCss(),\n            rollupPluginCommonjs({\n                extensions: ['.js', '.cjs'],\n                // Workaround: CJS -> ESM isn't supported yet by the plugin, so we needed\n                // to add our own custom workaround here. Requires a fork of\n                // rollupPluginCommonjs that supports the \"externalEsm\" option.\n                externalEsm: process.env.EXTERNAL_ESM_PACKAGES || [],\n            }),\n            rollupPluginWrapInstallTargets(!!isTreeshake, autoDetectNamedExports, installTargets),\n            rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            ...userDefinedRollup.plugins,\n            rollupPluginCatchUnresolved(),\n        ].filter(Boolean),\n        onwarn(warning, warn) {\n            // Warn about the first circular dependency, but then ignore the rest.\n            if (warning.code === 'CIRCULAR_DEPENDENCY') {\n                if (!isCircularImportFound) {\n                    isCircularImportFound = true;\n                    logUpdate(`Warning: 1+ circular dependencies found via \"${warning.importer}\".`);\n                }\n                return;\n            }\n            // Log \"unresolved\" import warnings as an error, causing Snowpack to fail at the end.\n            if (warning.code === 'PLUGIN_WARNING' &&\n                warning.plugin === 'snowpack:rollup-plugin-catch-unresolved') {\n                // Display posix-style on all environments, mainly to help with CI :)\n                if (warning.id) {\n                    const fileName = warning.id.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n                    logError(`${fileName}\\n   ${warning.message}`);\n                }\n                else {\n                    logError(`${warning.message}. See https://www.snowpack.dev/#troubleshooting`);\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate(formatInstallResults());\n            await packageBundle.write(outputOptions);\n        }\n        catch (_err) {\n            const err = _err;\n            const errFilePath = err.loc?.file || err.id;\n            if (!errFilePath) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on most errors. Therefore, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` and `err.id` have all the info that we need.\n            const failedExtension = path.extname(errFilePath);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension] || err.message;\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = errFilePath.replace(cwd + path.sep, '').replace(/\\\\/g, '/');\n            logError(`${colors.bold('snowpack')} failed to load ${colors.bold(fileName)}\\n  ${suggestion}`);\n            return FAILED_INSTALL_RETURN;\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    Object.entries(assetEntrypoints).forEach(([assetName, assetLoc]) => {\n        mkdirp.sync(path.dirname(`${destLoc}/${assetName}`));\n        fs.copyFileSync(assetLoc, `${destLoc}/${assetName}`);\n    });\n    return { success: true, importMap };\n}\nexport async function getInstallTargets(config, scannedFiles) {\n    const { knownEntrypoints, webDependencies } = config;\n    const installTargets = [];\n    if (knownEntrypoints) {\n        installTargets.push(...scanDepList(knownEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    if (scannedFiles) {\n        installTargets.push(...(await scanImportsFromFiles(scannedFiles, config)));\n    }\n    else {\n        installTargets.push(...(await scanImports(cwd, config)));\n    }\n    return installTargets;\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const installTargets = await getInstallTargets(config);\n    if (installTargets.length === 0) {\n        defaultLogError('Nothing to install.');\n        return;\n    }\n    const finalResult = await run({ ...commandOptions, installTargets });\n    if (finalResult.newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), finalResult.newLockfile);\n    }\n    if (finalResult.stats) {\n        console.log(printStats(finalResult.stats));\n    }\n    if (!finalResult.success || finalResult.hasError) {\n        process.exit(1);\n    }\n}\nexport async function run({ config, lockfile, installTargets, }) {\n    const { installOptions: { dest }, webDependencies, } = config;\n    installResults = [];\n    dependencyStats = null;\n    spinner = ora(banner);\n    spinnerHasError = false;\n    if (installTargets.length === 0) {\n        return {\n            success: true,\n            hasError: false,\n            importMap: { imports: {} },\n            newLockfile: null,\n            stats: null,\n        };\n    }\n    let newLockfile = null;\n    if (webDependencies && Object.keys(webDependencies).length > 0) {\n        newLockfile = await resolveTargetsFromRemoteCDN(lockfile, config).catch((err) => {\n            defaultLogError(err.message || err);\n            process.exit(1);\n        });\n    }\n    rimraf.sync(dest);\n    const startTime = Date.now();\n    const finalResult = await install(installTargets, {\n        lockfile: newLockfile,\n        logError: defaultLogError,\n        logUpdate: defaultLogUpdate,\n    }, config).catch((err) => {\n        if (err.loc) {\n            console.log('\\n' + colors.red(colors.bold(`✘ ${err.loc.file}`)));\n        }\n        if (err.url) {\n            console.log(colors.dim(`👉 ${err.url}`));\n        }\n        spinner.stop();\n        throw err;\n    });\n    if (finalResult.success) {\n        spinner.succeed(colors.bold(`snowpack`) +\n            ` install complete${spinnerHasError ? ' with errors.' : '.'}` +\n            colors.dim(` [${((Date.now() - startTime) / 1000).toFixed(2)}s]`));\n    }\n    else {\n        spinner.stop();\n    }\n    return {\n        success: finalResult.success,\n        hasError: spinnerHasError,\n        importMap: finalResult.importMap,\n        newLockfile,\n        stats: dependencyStats,\n    };\n}\n","import detectPort from 'detect-port';\nimport * as colors from 'kleur/colors';\nimport readline from 'readline';\nimport util from 'util';\nimport { isYarn } from '../util';\nconst cwd = process.cwd();\n/**\n * Get the actual port, based on the `defaultPort`.\n * If the default port was not available, then we'll prompt the user if its okay\n * to use the next available port.\n */\nexport async function getPort(defaultPort) {\n    const bestAvailablePort = await detectPort(defaultPort);\n    if (defaultPort !== bestAvailablePort) {\n        let useNextPort = false;\n        if (process.stdout.isTTY) {\n            const rl = readline.createInterface({ input: process.stdin, output: process.stdout });\n            useNextPort = await new Promise((resolve) => {\n                rl.question(colors.yellow(`! Port ${colors.bold(defaultPort)} not available. Run on port ${colors.bold(bestAvailablePort)} instead? (Y/n) `), (answer) => {\n                    resolve(!/^no?$/i.test(answer));\n                });\n            });\n            rl.close();\n        }\n        if (!useNextPort) {\n            console.error(colors.red(`✘ Port ${colors.bold(defaultPort)} not available. Use ${colors.bold('--port')} to specify a different port.`));\n            console.error();\n            process.exit(1);\n        }\n    }\n    return bestAvailablePort;\n}\nfunction getStateString(workerState, isWatch) {\n    if (workerState.state) {\n        if (Array.isArray(workerState.state)) {\n            return [colors[workerState.state[1]], workerState.state[0]];\n        }\n        return [colors.dim, workerState.state];\n    }\n    if (workerState.done) {\n        return workerState.error ? [colors.red, 'FAIL'] : [colors.green, 'DONE'];\n    }\n    if (isWatch) {\n        if (workerState.config.watch) {\n            return [colors.dim, 'WATCH'];\n        }\n    }\n    return [colors.dim, 'READY'];\n}\nconst WORKER_BASE_STATE = { done: false, error: null, output: '' };\nexport function paint(bus, registeredWorkers, buildMode, devMode) {\n    let port;\n    let protocol = '';\n    let startTimeMs;\n    let ips = [];\n    let consoleOutput = '';\n    let installOutput = '';\n    let isInstalling = false;\n    let hasBeenCleared = false;\n    let missingWebModule = null;\n    const allWorkerStates = {};\n    for (const config of registeredWorkers) {\n        allWorkerStates[config.id] = { ...WORKER_BASE_STATE, config };\n    }\n    function repaint() {\n        process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n        process.stdout.write(`${colors.bold('Snowpack')}\\n\\n`);\n        // Dashboard\n        if (devMode) {\n            const isServerStarted = startTimeMs > 0 && port > 0 && protocol;\n            if (isServerStarted) {\n                process.stdout.write(`  ${colors.bold(colors.cyan(`${protocol}//localhost:${port}`))}`);\n                for (const ip of ips) {\n                    process.stdout.write(`${colors.cyan(` > `)}${colors.bold(colors.cyan(`${protocol}//${ip}:${port}`))}`);\n                }\n                process.stdout.write('\\n');\n                process.stdout.write(colors.dim(startTimeMs < 1000 ? `  Server started in ${startTimeMs}ms.` : `  Server started.`));\n                process.stdout.write('\\n\\n');\n            }\n            else {\n                process.stdout.write(colors.dim(`  Server starting…`) + '\\n\\n');\n            }\n        }\n        if (buildMode) {\n            process.stdout.write('  ' + colors.bold(colors.cyan(buildMode.dest)));\n            process.stdout.write(colors.dim(` Building your application...\\n\\n`));\n        }\n        for (const config of registeredWorkers) {\n            if (devMode && config.type === 'bundle') {\n                continue;\n            }\n            const workerState = allWorkerStates[config.id];\n            const dotLength = 24 - config.id.length;\n            const dots = colors.dim(''.padEnd(dotLength, '.'));\n            const [fmt, stateString] = getStateString(workerState, !!devMode);\n            const spacer = ' '; //.padEnd(8 - stateString.length);\n            let cmdMsg = `${config.plugin && config.cmd[0] !== '(' ? '(plugin) ' : ''}${config.cmd}`;\n            if (cmdMsg.length > 52) {\n                cmdMsg = cmdMsg.substr(0, 52) + '...';\n            }\n            const cmdStr = stateString === 'FAIL' ? colors.red(cmdMsg) : colors.dim(cmdMsg);\n            process.stdout.write(`  ${config.id}${dots}[${fmt(stateString)}]${spacer}${cmdStr}\\n`);\n        }\n        process.stdout.write('\\n');\n        if (isInstalling) {\n            process.stdout.write(`${colors.underline(colors.bold('▼ snowpack install'))}\\n\\n`);\n            process.stdout.write('  ' + installOutput.trim().replace(/\\n/gm, '\\n  '));\n            process.stdout.write('\\n\\n');\n            return;\n        }\n        if (missingWebModule) {\n            const { id, pkgName, spec } = missingWebModule;\n            process.stdout.write(`${colors.red(colors.underline(colors.bold('▼ Snowpack')))}\\n\\n`);\n            if (devMode) {\n                process.stdout.write(`  Package ${colors.bold(pkgName)} not found!\\n`);\n                process.stdout.write(colors.dim(`  in ${id}`));\n                process.stdout.write(`\\n\\n`);\n                process.stdout.write(`  ${colors.bold('Press Enter')} to automatically run ${colors.bold(isYarn(cwd) ? `yarn add ${pkgName}` : `npm install --save ${pkgName}`)}.\\n`);\n                process.stdout.write(`  Or, Exit Snowpack and install manually to continue.\\n`);\n            }\n            else {\n                process.stdout.write(`  Dependency ${colors.bold(spec)} not found!\\n\\n`);\n                // process.stdout.write(\n                //   `  Run ${colors.bold('snowpack install')} to install all required dependencies.\\n\\n`,\n                // );\n                process.exit(1);\n            }\n            return;\n        }\n        for (const config of registeredWorkers) {\n            const workerState = allWorkerStates[config.id];\n            if (workerState && workerState.output) {\n                const colorsFn = Array.isArray(workerState.error) ? colors.red : colors.reset;\n                process.stdout.write(`${colorsFn(colors.underline(colors.bold('▼ ' + config.id)))}\\n\\n`);\n                process.stdout.write(workerState.output\n                    ? '  ' + workerState.output.trim().replace(/\\n/gm, '\\n  ')\n                    : hasBeenCleared\n                        ? colors.dim('  Output cleared.')\n                        : colors.dim('  No output, yet.'));\n                process.stdout.write('\\n\\n');\n            }\n        }\n        if (consoleOutput) {\n            process.stdout.write(`${colors.underline(colors.bold('▼ Console'))}\\n\\n`);\n            process.stdout.write(consoleOutput\n                ? '  ' + consoleOutput.trim().replace(/\\n/gm, '\\n  ')\n                : hasBeenCleared\n                    ? colors.dim('  Output cleared.')\n                    : colors.dim('  No output, yet.'));\n            process.stdout.write('\\n\\n');\n        }\n        const overallStatus = Object.values(allWorkerStates).reduce((result, { done, error }) => {\n            return {\n                done: result.done && done,\n                error: result.error || error,\n            };\n        });\n        if (overallStatus.error) {\n            process.stdout.write(`${colors.underline(colors.red(colors.bold('▼ Result')))}\\n\\n`);\n            process.stdout.write('  ⚠️  Finished, with errors.');\n            process.stdout.write('\\n\\n');\n            process.exit(1);\n        }\n        else if (overallStatus.done) {\n            process.stdout.write(`${colors.underline(colors.green(colors.bold('▶ Build Complete!')))}\\n\\n`);\n        }\n    }\n    bus.on('WORKER_MSG', ({ id, msg }) => {\n        allWorkerStates[id].output += msg;\n        repaint();\n    });\n    bus.on('WORKER_UPDATE', ({ id, state }) => {\n        if (typeof state !== undefined) {\n            allWorkerStates[id].state = state;\n        }\n        repaint();\n    });\n    bus.on('WORKER_COMPLETE', ({ id, error }) => {\n        allWorkerStates[id].state = null;\n        allWorkerStates[id].done = true;\n        allWorkerStates[id].error = allWorkerStates[id].error || error;\n        repaint();\n    });\n    bus.on('WORKER_RESET', ({ id }) => {\n        allWorkerStates[id] = { ...WORKER_BASE_STATE, config: allWorkerStates[id].config };\n        repaint();\n    });\n    bus.on('CONSOLE', ({ level, args }) => {\n        if (isInstalling) {\n            const msg = util.format.apply(util, args);\n            if (!msg.startsWith('[404] ')) {\n                installOutput += msg;\n            }\n        }\n        else {\n            consoleOutput += `[${level}] ${util.format.apply(util, args)}\\n`;\n        }\n        repaint();\n    });\n    bus.on('NEW_SESSION', () => {\n        if (consoleOutput) {\n            consoleOutput = ``;\n            hasBeenCleared = true;\n        }\n        // Reset all per-file build scripts\n        for (const config of registeredWorkers) {\n            if (config.type === 'build') {\n                allWorkerStates[config.id] = {\n                    ...WORKER_BASE_STATE,\n                    config: allWorkerStates[config.id].config,\n                };\n            }\n        }\n        repaint();\n    });\n    bus.on('INSTALLING', () => {\n        isInstalling = true;\n        installOutput = '';\n        repaint();\n    });\n    bus.on('INSTALL_COMPLETE', () => {\n        setTimeout(() => {\n            missingWebModule = null;\n            isInstalling = false;\n            installOutput = '';\n            consoleOutput = ``;\n            hasBeenCleared = true;\n            repaint();\n        }, 2000);\n    });\n    bus.on('MISSING_WEB_MODULE', ({ id, data }) => {\n        if (!missingWebModule && data) {\n            missingWebModule = { id, ...data };\n        }\n        if (missingWebModule && missingWebModule.id === id) {\n            if (!data) {\n                missingWebModule = null;\n            }\n            else {\n                missingWebModule = { id, ...data };\n            }\n        }\n        repaint();\n    });\n    bus.on('SERVER_START', (info) => {\n        startTimeMs = info.startTimeMs;\n        port = info.port;\n        protocol = info.protocol;\n        ips = info.ips;\n        repaint();\n    });\n    if (devMode) {\n        readline.emitKeypressEvents(process.stdin);\n        process.stdin.on('keypress', (_, key) => {\n            if (key.name !== 'return' && key.name !== 'enter') {\n                return;\n            }\n            if (!missingWebModule) {\n                return;\n            }\n            devMode.addPackage(missingWebModule.pkgName);\n            repaint();\n        });\n    }\n    repaint();\n}\n","import merge from 'deepmerge';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { promises as fs } from 'fs';\nimport glob from 'glob';\nimport * as colors from 'kleur/colors';\nimport mkdirp from 'mkdirp';\nimport npmRunPath from 'npm-run-path';\nimport path from 'path';\nimport rimraf from 'rimraf';\nimport { transformFileImports } from '../rewrite-imports';\nimport { printStats } from '../stats-formatter';\nimport { getExt } from '../util';\nimport { generateEnvModule, getFileBuilderForWorker, wrapCssModuleResponse, wrapEsmProxyResponse, wrapImportMeta, } from './build-util';\nimport { stopEsbuild } from './esbuildPlugin';\nimport { createImportResolver } from './import-resolver';\nimport { getInstallTargets, run as installRunner } from './install';\nimport { paint } from './paint';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nasync function installOptimizedDependencies(allFilesToResolveImports, installDest, commandOptions) {\n    console.log(colors.yellow('! optimizing dependencies...'));\n    const installConfig = merge(commandOptions.config, {\n        installOptions: {\n            dest: installDest,\n            env: { NODE_ENV: process.env.NODE_ENV || 'production' },\n            treeshake: commandOptions.config.installOptions.treeshake ?? true,\n        },\n    });\n    // 1. Scan imports from your final built JS files.\n    const installTargets = await getInstallTargets(installConfig, Object.values(allFilesToResolveImports));\n    // 2. Install dependencies, based on the scan of your final build.\n    const installResult = await installRunner({\n        ...commandOptions,\n        installTargets,\n        config: installConfig,\n    });\n    // 3. Print stats immediate after install output.\n    if (installResult.stats) {\n        console.log(printStats(installResult.stats));\n    }\n    return installResult;\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const messageBus = new EventEmitter();\n    const relevantWorkers = [];\n    const allBuildExtensions = [];\n    for (const workerConfig of config.scripts) {\n        const { id, type, match } = workerConfig;\n        // web_modules dependencies are now installed directly into the build directory,\n        // instead of being copied like a traditional mount. This is required until we\n        // move the \"web_modules\" destination configuration out of the \"scripts\" config.\n        if (id === 'mount:web_modules') {\n            continue;\n        }\n        if (type === 'build' || type === 'run' || type === 'mount' || type === 'bundle') {\n            relevantWorkers.push(workerConfig);\n        }\n        if (type === 'build') {\n            allBuildExtensions.push(...match);\n        }\n    }\n    let bundleWorker = config.scripts.find((s) => s.type === 'bundle');\n    let installWorker = config.scripts.find((s) => s.id === 'mount:web_modules');\n    const isBundledHardcoded = config.devOptions.bundle !== undefined;\n    const isBundled = isBundledHardcoded ? !!config.devOptions.bundle : !!bundleWorker;\n    if (!bundleWorker) {\n        bundleWorker = {\n            id: 'bundle:*',\n            type: 'bundle',\n            match: ['*'],\n            cmd: '',\n            watch: undefined,\n        };\n        relevantWorkers.push(bundleWorker);\n    }\n    const buildDirectoryLoc = isBundled ? path.join(cwd, `.build`) : config.devOptions.out;\n    const internalFilesBuildLoc = path.join(buildDirectoryLoc, config.buildOptions.metaDir);\n    const finalDirectoryLoc = config.devOptions.out;\n    if (config.scripts.length <= 1) {\n        console.error(colors.red(`No build scripts found, so nothing to build.`));\n        console.error(`See https://www.snowpack.dev/#build-scripts for help getting started.`);\n        return;\n    }\n    rimraf.sync(buildDirectoryLoc);\n    mkdirp.sync(buildDirectoryLoc);\n    mkdirp.sync(internalFilesBuildLoc);\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(finalDirectoryLoc);\n        mkdirp.sync(finalDirectoryLoc);\n    }\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    let relDest = path.relative(cwd, config.devOptions.out);\n    if (!relDest.startsWith(`..${path.sep}`)) {\n        relDest = `.${path.sep}` + relDest;\n    }\n    paint(messageBus, relevantWorkers, { dest: relDest }, undefined);\n    if (!isBundled) {\n        messageBus.emit('WORKER_UPDATE', {\n            id: bundleWorker.id,\n            state: ['SKIP', 'dim'],\n        });\n    }\n    for (const workerConfig of relevantWorkers) {\n        const { id, type } = workerConfig;\n        if (type !== 'run') {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        const workerPromise = execa.command(workerConfig.cmd, {\n            env: npmRunPath.env(),\n            extendEnv: true,\n            shell: true,\n            cwd,\n        });\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCHING' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n        await workerPromise;\n    }\n    // Write the `import.meta.env` contents file to disk\n    await fs.writeFile(path.join(internalFilesBuildLoc, 'env.js'), generateEnvModule('production'));\n    const mountDirDetails = relevantWorkers\n        .map((scriptConfig) => {\n        const { id, type, args } = scriptConfig;\n        if (id === 'mount:web_modules') {\n            return false;\n        }\n        if (type !== 'mount') {\n            return false;\n        }\n        const dirDisk = path.resolve(cwd, args.fromDisk);\n        const dirDest = path.resolve(buildDirectoryLoc, args.toUrl.replace(/^\\//, ''));\n        return [id, dirDisk, dirDest];\n    })\n        .filter(Boolean);\n    const includeFileSets = [];\n    for (const [id, dirDisk, dirDest] of mountDirDetails) {\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        let allFiles;\n        try {\n            allFiles = glob.sync(`**/*`, {\n                ignore: config.exclude,\n                cwd: dirDisk,\n                absolute: true,\n                nodir: true,\n                dot: true,\n            });\n            const allBuildNeededFiles = [];\n            await Promise.all(allFiles.map(async (f) => {\n                f = path.resolve(f); // this is necessary since glob.sync() returns paths with / on windows.  path.resolve() will switch them to the native path separator.\n                const { baseExt } = getExt(f);\n                if (allBuildExtensions.includes(baseExt) ||\n                    baseExt === '.jsx' ||\n                    baseExt === '.tsx' ||\n                    baseExt === '.ts' ||\n                    baseExt === '.js') {\n                    allBuildNeededFiles.push(f);\n                    return;\n                }\n                const outPath = f.replace(dirDisk, dirDest);\n                mkdirp.sync(path.dirname(outPath));\n                // replace %PUBLIC_URL% in HTML files\n                if (baseExt === '.html') {\n                    let code = await fs.readFile(f, 'utf8');\n                    code = code.replace(/%PUBLIC_URL%\\/?/g, config.buildOptions.baseUrl);\n                    return fs.writeFile(outPath, code, 'utf8');\n                }\n                return fs.copyFile(f, outPath);\n            }));\n            includeFileSets.push([dirDisk, dirDest, allBuildNeededFiles]);\n            messageBus.emit('WORKER_COMPLETE', { id });\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: err.toString() });\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        }\n    }\n    const allBuiltFromFiles = new Set();\n    const allFilesToResolveImports = {};\n    for (const workerConfig of relevantWorkers) {\n        const { id, match, type } = workerConfig;\n        if (type !== 'build' || match.length === 0) {\n            continue;\n        }\n        messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n        for (const [dirDisk, dirDest, allFiles] of includeFileSets) {\n            for (const locOnDisk of allFiles) {\n                const inputExt = getExt(locOnDisk);\n                if (!match.includes(inputExt.baseExt) && !match.includes(inputExt.expandedExt)) {\n                    continue;\n                }\n                const fileContents = await fs.readFile(locOnDisk, { encoding: 'utf8' });\n                let fileBuilder = getFileBuilderForWorker(cwd, workerConfig, messageBus);\n                if (!fileBuilder) {\n                    continue;\n                }\n                let outLoc = locOnDisk.replace(dirDisk, dirDest);\n                const extToReplace = srcFileExtensionMapping[inputExt.baseExt];\n                if (extToReplace) {\n                    outLoc = outLoc.replace(new RegExp(`\\\\${inputExt.baseExt}$`), extToReplace);\n                }\n                const builtFile = await fileBuilder({\n                    contents: fileContents,\n                    filePath: locOnDisk,\n                    isDev: false,\n                });\n                if (!builtFile) {\n                    continue;\n                }\n                let { result: code, resources } = builtFile;\n                const urlPath = outLoc.substr(dirDest.length + 1);\n                for (const plugin of config.plugins) {\n                    if (plugin.transform) {\n                        code =\n                            (await plugin.transform({ contents: fileContents, urlPath, isDev: false }))?.result ||\n                                code;\n                    }\n                }\n                if (!code) {\n                    continue;\n                }\n                allBuiltFromFiles.add(locOnDisk);\n                const { baseExt, expandedExt } = getExt(outLoc);\n                switch (baseExt) {\n                    case '.js': {\n                        if (resources?.css) {\n                            const cssOutPath = outLoc.replace(/.js$/, '.css');\n                            await fs.mkdir(path.dirname(cssOutPath), { recursive: true });\n                            await fs.writeFile(cssOutPath, resources.css);\n                            code = `import './${path.basename(cssOutPath)}';\\n` + code;\n                        }\n                        code = wrapImportMeta({ code, env: true, hmr: false, config });\n                        allFilesToResolveImports[outLoc] = { baseExt, expandedExt, code, locOnDisk };\n                        break;\n                    }\n                    case '.html': {\n                        allFilesToResolveImports[outLoc] = { baseExt, expandedExt, code, locOnDisk };\n                        break;\n                    }\n                    default: {\n                        await fs.mkdir(path.dirname(outLoc), { recursive: true });\n                        await fs.writeFile(outLoc, code);\n                        break;\n                    }\n                }\n            }\n        }\n        messageBus.emit('WORKER_COMPLETE', { id, error: null });\n    }\n    stopEsbuild();\n    const webModulesPath = installWorker.args.toUrl;\n    const installDest = path.join(buildDirectoryLoc, webModulesPath);\n    const installResult = await installOptimizedDependencies(allFilesToResolveImports, installDest, commandOptions);\n    if (!installResult.success || installResult.hasError) {\n        process.exit(1);\n    }\n    const allProxiedFiles = new Set();\n    for (const [outLoc, file] of Object.entries(allFilesToResolveImports)) {\n        const resolveImportSpecifier = createImportResolver({\n            fileLoc: file.locOnDisk,\n            webModulesPath,\n            dependencyImportMap: installResult.importMap,\n            isDev: false,\n            isBundled,\n            config,\n        });\n        const resolvedCode = await transformFileImports(file, (spec) => {\n            // Try to resolve the specifier to a known URL in the project\n            const resolvedImportUrl = resolveImportSpecifier(spec);\n            if (resolvedImportUrl) {\n                // We treat \".proxy.js\" files special: we need to make sure that they exist on disk\n                // in the final build, so we mark them to be written to disk at the next step.\n                if (resolvedImportUrl.endsWith('.proxy.js')) {\n                    allProxiedFiles.add(resolvedImportUrl.startsWith('/')\n                        ? path.resolve(cwd, spec)\n                        : path.resolve(path.dirname(outLoc), spec));\n                }\n                return resolvedImportUrl;\n            }\n            return spec;\n        });\n        await fs.mkdir(path.dirname(outLoc), { recursive: true });\n        await fs.writeFile(outLoc, resolvedCode);\n    }\n    for (const proxiedFileLoc of allProxiedFiles) {\n        const proxiedCode = await fs.readFile(proxiedFileLoc, { encoding: 'utf8' });\n        const proxiedExt = path.extname(proxiedFileLoc);\n        const proxiedUrl = proxiedFileLoc.substr(buildDirectoryLoc.length);\n        const proxyCode = proxiedFileLoc.endsWith('.module.css')\n            ? await wrapCssModuleResponse({\n                url: proxiedUrl,\n                code: proxiedCode,\n                ext: proxiedExt,\n                config,\n            })\n            : wrapEsmProxyResponse({\n                url: proxiedUrl,\n                code: proxiedCode,\n                ext: proxiedExt,\n                config,\n            });\n        const proxyFileLoc = proxiedFileLoc + '.proxy.js';\n        await fs.writeFile(proxyFileLoc, proxyCode, { encoding: 'utf8' });\n    }\n    if (!isBundled) {\n        messageBus.emit('WORKER_COMPLETE', { id: bundleWorker.id, error: null });\n        messageBus.emit('WORKER_UPDATE', {\n            id: bundleWorker.id,\n            state: ['SKIP', isBundledHardcoded ? 'dim' : 'yellow'],\n        });\n        if (!isBundledHardcoded) {\n            messageBus.emit('WORKER_MSG', {\n                id: bundleWorker.id,\n                level: 'log',\n                msg: `\"plugins\": [\"@snowpack/plugin-webpack\"]\\n\\n` +\n                    `Connect a bundler plugin to optimize your build for production.\\n` +\n                    colors.dim(`Set \"devOptions.bundle\" configuration to false to remove this message.`),\n            });\n        }\n    }\n    else {\n        try {\n            messageBus.emit('WORKER_UPDATE', { id: bundleWorker.id, state: ['RUNNING', 'yellow'] });\n            await bundleWorker?.plugin.bundle({\n                srcDirectory: buildDirectoryLoc,\n                destDirectory: finalDirectoryLoc,\n                jsFilePaths: allBuiltFromFiles,\n                log: (msg) => {\n                    messageBus.emit('WORKER_MSG', { id: bundleWorker.id, level: 'log', msg });\n                },\n            });\n            messageBus.emit('WORKER_COMPLETE', { id: bundleWorker.id, error: null });\n        }\n        catch (err) {\n            messageBus.emit('WORKER_MSG', {\n                id: bundleWorker.id,\n                level: 'error',\n                msg: err.toString(),\n            });\n            messageBus.emit('WORKER_COMPLETE', { id: bundleWorker.id, error: err });\n        }\n    }\n    if (finalDirectoryLoc !== buildDirectoryLoc) {\n        rimraf.sync(buildDirectoryLoc);\n    }\n}\n","import WebSocket from 'ws';\nexport class EsmHmrEngine {\n    constructor(options = {}) {\n        this.clients = new Set();\n        this.dependencyTree = new Map();\n        const wss = options.server\n            ? new WebSocket.Server({ noServer: true })\n            : new WebSocket.Server({ port: 12321 });\n        if (options.server) {\n            options.server.on('upgrade', (req, socket, head) => {\n                // Only handle upgrades to ESM-HMR requests, ignore others.\n                if (req.headers['sec-websocket-protocol'] !== 'esm-hmr') {\n                    return;\n                }\n                wss.handleUpgrade(req, socket, head, (client) => {\n                    wss.emit('connection', client, req);\n                });\n            });\n        }\n        wss.on('connection', (client) => {\n            this.connectClient(client);\n            this.registerListener(client);\n        });\n    }\n    registerListener(client) {\n        client.on('message', (data) => {\n            const message = JSON.parse(data.toString());\n            if (message.type === 'hotAccept') {\n                const entry = this.getEntry(message.id, true);\n                entry.isHmrAccepted = true;\n                entry.isHmrEnabled = true;\n            }\n        });\n    }\n    createEntry(sourceUrl) {\n        const newEntry = {\n            dependencies: new Set(),\n            dependents: new Set(),\n            needsReplacement: false,\n            isHmrEnabled: false,\n            isHmrAccepted: false,\n        };\n        this.dependencyTree.set(sourceUrl, newEntry);\n        return newEntry;\n    }\n    getEntry(sourceUrl, createIfNotFound = false) {\n        const result = this.dependencyTree.get(sourceUrl);\n        if (result) {\n            return result;\n        }\n        if (createIfNotFound) {\n            return this.createEntry(sourceUrl);\n        }\n        return null;\n    }\n    setEntry(sourceUrl, imports, isHmrEnabled = false) {\n        const result = this.getEntry(sourceUrl, true);\n        const outdatedDependencies = new Set(result.dependencies);\n        result.isHmrEnabled = isHmrEnabled;\n        for (const importUrl of imports) {\n            this.addRelationship(sourceUrl, importUrl);\n            outdatedDependencies.delete(importUrl);\n        }\n        for (const importUrl of outdatedDependencies) {\n            this.removeRelationship(sourceUrl, importUrl);\n        }\n    }\n    removeRelationship(sourceUrl, importUrl) {\n        let importResult = this.getEntry(importUrl);\n        importResult && importResult.dependents.delete(sourceUrl);\n        const sourceResult = this.getEntry(sourceUrl);\n        sourceResult && sourceResult.dependencies.delete(importUrl);\n    }\n    addRelationship(sourceUrl, importUrl) {\n        if (importUrl !== sourceUrl) {\n            let importResult = this.getEntry(importUrl, true);\n            importResult.dependents.add(sourceUrl);\n            const sourceResult = this.getEntry(sourceUrl, true);\n            sourceResult.dependencies.add(importUrl);\n        }\n    }\n    markEntryForReplacement(entry, state) {\n        entry.needsReplacement = state;\n    }\n    broadcastMessage(data) {\n        this.clients.forEach((client) => {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(JSON.stringify(data));\n            }\n            else {\n                this.disconnectClient(client);\n            }\n        });\n    }\n    connectClient(client) {\n        this.clients.add(client);\n    }\n    disconnectClient(client) {\n        client.terminate();\n        this.clients.delete(client);\n    }\n    disconnectAllClients() {\n        for (const client of this.clients) {\n            this.disconnectClient(client);\n        }\n    }\n}\n","/**\n * This license applies to parts of this file originating from the\n * https://github.com/lukejacksonn/servor repository:\n *\n * MIT License\n * Copyright (c) 2019 Luke Jackson\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nimport cacache from 'cacache';\nimport isCompressible from 'compressible';\nimport etag from 'etag';\nimport merge from 'deepmerge';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { existsSync, promises as fs, readFileSync } from 'fs';\nimport http from 'http';\nimport https from 'https';\nimport HttpProxy from 'http-proxy';\nimport http2 from 'http2';\nimport * as colors from 'kleur/colors';\nimport mime from 'mime-types';\nimport npmRunPath from 'npm-run-path';\nimport os from 'os';\nimport path from 'path';\nimport onProcessExit from 'signal-exit';\nimport stream from 'stream';\nimport url from 'url';\nimport zlib from 'zlib';\nimport { EsmHmrEngine } from '../hmr-server-engine';\nimport { scanCodeImportsExports, transformFileImports, transformEsmImports, } from '../rewrite-imports';\nimport { BUILD_CACHE, checkLockfileHash, DEV_DEPENDENCIES_DIR, isYarn, openInBrowser, resolveDependencyManifest, updateLockfileHash, getExt, parsePackageImportSpecifier, } from '../util';\nimport { generateEnvModule, getFileBuilderForWorker, wrapCssModuleResponse, wrapEsmProxyResponse, wrapHtmlResponse, wrapImportMeta, } from './build-util';\nimport { createImportResolver } from './import-resolver';\nimport { command as installCommand } from './install';\nimport { getPort, paint } from './paint';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nconst HMR_DEV_CODE = readFileSync(path.join(__dirname, '../assets/hmr.js'));\nconst DEFAULT_PROXY_ERROR_HANDLER = (err, req, res) => {\n    const reqUrl = req.url;\n    console.error(`✘ ${reqUrl}\\n${err.message}`);\n    sendError(res, 502);\n};\nfunction shouldProxy(pathPrefix, req) {\n    const reqPath = decodeURI(url.parse(req.url).pathname);\n    return reqPath.startsWith(pathPrefix);\n}\nfunction getEncodingType(ext) {\n    if (ext === '.js' || ext === '.css' || ext === '.html' || ext === '.json') {\n        return 'utf-8';\n    }\n    else {\n        return 'binary';\n    }\n}\nconst sendFile = (req, res, body, ext = '.html') => {\n    const ETag = etag(body, { weak: true });\n    const contentType = mime.contentType(ext);\n    const headers = {\n        'Content-Type': contentType || 'application/octet-stream',\n        'Access-Control-Allow-Origin': '*',\n        ETag,\n        Vary: 'Accept-Encoding',\n    };\n    if (req.headers['if-none-match'] === ETag) {\n        res.writeHead(304, headers);\n        res.end();\n        return;\n    }\n    let acceptEncoding = req.headers['accept-encoding'] || '';\n    if (req.headers['cache-control']?.includes('no-transform') ||\n        ['HEAD', 'OPTIONS'].includes(req.method) ||\n        !contentType ||\n        !isCompressible(contentType)) {\n        acceptEncoding = '';\n    }\n    function onError(err) {\n        if (err) {\n            res.end();\n            console.error(colors.red(`  ✘ An error occurred while compressing ${colors.bold(req.url)}`), err);\n        }\n    }\n    if (/\\bgzip\\b/.test(acceptEncoding) && stream.Readable.from) {\n        const bodyStream = stream.Readable.from([body]);\n        headers['Content-Encoding'] = 'gzip';\n        res.writeHead(200, headers);\n        stream.pipeline(bodyStream, zlib.createGzip(), res, onError);\n        return;\n    }\n    res.writeHead(200, headers);\n    res.write(body, getEncodingType(ext));\n    res.end();\n};\nconst sendError = (res, status) => {\n    res.writeHead(status);\n    res.end();\n};\nfunction getUrlFromFile(mountedDirectories, fileLoc) {\n    for (const [dirDisk, dirUrl] of mountedDirectories) {\n        if (fileLoc.startsWith(dirDisk + path.sep)) {\n            const { baseExt } = getExt(fileLoc);\n            const resolvedDirUrl = dirUrl === '/' ? '' : dirUrl;\n            return fileLoc\n                .replace(dirDisk, resolvedDirUrl)\n                .replace(/[/\\\\]+/g, '/')\n                .replace(new RegExp(`\\\\${baseExt}$`), srcFileExtensionMapping[baseExt] || baseExt);\n        }\n    }\n    return null;\n}\nfunction getMountedDirectory(cwd, workerConfig) {\n    const { args } = workerConfig;\n    return [path.resolve(cwd, args.fromDisk), args.toUrl];\n}\nlet currentlyRunningCommand = null;\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const { port: defaultPort, open, hmr: isHmr } = config.devOptions;\n    let serverStart = Date.now();\n    const port = await getPort(defaultPort);\n    // Reset the clock if we had to wait for the user to select a new port.\n    if (port !== defaultPort) {\n        serverStart = Date.now();\n    }\n    const inMemoryBuildCache = new Map();\n    const inMemoryResourceCache = new Map();\n    const filesBeingDeleted = new Set();\n    const filesBeingBuilt = new Map();\n    const messageBus = new EventEmitter();\n    const mountedDirectories = [];\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    // Start painting immediately, so we can surface errors & warnings to the\n    // user, and they can watch the server starting up. Search for ”SERVER_START”\n    // for the actual start event below.\n    paint(messageBus, config.scripts, undefined, {\n        addPackage: async (pkgName) => {\n            isLiveReloadPaused = true;\n            messageBus.emit('INSTALLING');\n            currentlyRunningCommand = execa(isYarn(cwd) ? 'yarn' : 'npm', isYarn(cwd) ? ['add', pkgName] : ['install', '--save', pkgName], {\n                env: npmRunPath.env(),\n                extendEnv: true,\n                shell: true,\n                cwd,\n            });\n            currentlyRunningCommand.stdout.on('data', (data) => process.stdout.write(data));\n            currentlyRunningCommand.stderr.on('data', (data) => process.stderr.write(data));\n            await currentlyRunningCommand;\n            currentlyRunningCommand = installCommand(installCommandOptions);\n            await currentlyRunningCommand;\n            await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n            await cacache.rm.all(BUILD_CACHE);\n            inMemoryBuildCache.clear();\n            currentlyRunningCommand = null;\n            dependencyImportMap = JSON.parse(await fs\n                .readFile(dependencyImportMapLoc, { encoding: 'utf-8' })\n                .catch(() => `{\"imports\": {}}`));\n            messageBus.emit('INSTALL_COMPLETE');\n            isLiveReloadPaused = false;\n        },\n    });\n    // Set the proper install options, in case an install is needed.\n    const dependencyImportMapLoc = path.join(DEV_DEPENDENCIES_DIR, 'import-map.json');\n    const installCommandOptions = merge(commandOptions, {\n        config: {\n            installOptions: {\n                dest: DEV_DEPENDENCIES_DIR,\n                env: { NODE_ENV: process.env.NODE_ENV || 'development' },\n                treeshake: false,\n            },\n        },\n    });\n    // Start with a fresh install of your dependencies, if needed.\n    if (!(await checkLockfileHash(DEV_DEPENDENCIES_DIR)) || !existsSync(dependencyImportMapLoc)) {\n        console.log(colors.yellow('! updating dependencies...'));\n        await installCommand(installCommandOptions);\n        await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n    }\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = JSON.parse(await fs.readFile(dependencyImportMapLoc, { encoding: 'utf-8' }));\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    /** Rerun `snowpack install` while dev server is running */\n    async function reinstallDependencies() {\n        if (!currentlyRunningCommand) {\n            isLiveReloadPaused = true;\n            messageBus.emit('INSTALLING');\n            currentlyRunningCommand = installCommand(installCommandOptions);\n            await currentlyRunningCommand.then(async () => {\n                dependencyImportMap = JSON.parse(await fs\n                    .readFile(dependencyImportMapLoc, { encoding: 'utf-8' })\n                    .catch(() => `{\"imports\": {}}`));\n                await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n                await cacache.rm.all(BUILD_CACHE);\n                inMemoryBuildCache.clear();\n                messageBus.emit('INSTALL_COMPLETE');\n                isLiveReloadPaused = false;\n                currentlyRunningCommand = null;\n            });\n        }\n    }\n    async function buildFile(fileContents, fileLoc, reqPath, fileBuilder) {\n        let builtFileResult;\n        let fileBuilderPromise = filesBeingBuilt.get(fileLoc);\n        if (fileBuilderPromise) {\n            builtFileResult = await fileBuilderPromise;\n        }\n        else {\n            fileBuilderPromise = (async () => {\n                let _builtFileResult = { result: fileContents };\n                if (fileBuilder) {\n                    _builtFileResult =\n                        (await fileBuilder({\n                            contents: fileContents,\n                            filePath: fileLoc,\n                            isDev: true,\n                        })) || _builtFileResult;\n                }\n                for (const plugin of config.plugins) {\n                    if (plugin.transform) {\n                        _builtFileResult.result =\n                            (await plugin.transform({\n                                contents: _builtFileResult.result,\n                                urlPath: reqPath,\n                                isDev: true,\n                            }))?.result || _builtFileResult.result;\n                    }\n                }\n                return _builtFileResult;\n            })();\n            try {\n                filesBeingBuilt.set(fileLoc, fileBuilderPromise);\n                builtFileResult = await fileBuilderPromise;\n            }\n            finally {\n                filesBeingBuilt.delete(fileLoc);\n            }\n        }\n        const { baseExt, expandedExt } = getExt(fileLoc);\n        if (baseExt === '.js' ||\n            srcFileExtensionMapping[baseExt] === '.js' ||\n            baseExt === '.html' ||\n            srcFileExtensionMapping[baseExt] === '.html') {\n            let missingWebModule = null;\n            const webModulesScript = config.scripts.find((script) => script.id === 'mount:web_modules');\n            const webModulesPath = webModulesScript ? webModulesScript.args.toUrl : '/web_modules';\n            const resolveImportSpecifier = createImportResolver({\n                fileLoc,\n                webModulesPath,\n                dependencyImportMap,\n                isDev: true,\n                isBundled: false,\n                config,\n            });\n            builtFileResult.result = await transformFileImports({\n                locOnDisk: fileLoc,\n                code: builtFileResult.result,\n                baseExt: srcFileExtensionMapping[baseExt] || baseExt,\n                expandedExt,\n            }, (spec) => {\n                // Try to resolve the specifier to a known URL in the project\n                const resolvedImportUrl = resolveImportSpecifier(spec);\n                if (resolvedImportUrl) {\n                    return resolvedImportUrl;\n                }\n                // If that fails, return a placeholder import and attempt to resolve.\n                const [packageName] = parsePackageImportSpecifier(spec);\n                const [depManifestLoc] = resolveDependencyManifest(packageName, cwd);\n                const doesPackageExist = !!depManifestLoc;\n                if (doesPackageExist) {\n                    reinstallDependencies();\n                }\n                else {\n                    missingWebModule = {\n                        spec: spec,\n                        pkgName: packageName,\n                    };\n                }\n                // Return a placeholder while Snowpack goes out and tries to re-install (or warn)\n                // on the missing package.\n                return spec;\n            });\n            messageBus.emit('MISSING_WEB_MODULE', {\n                id: fileLoc,\n                data: missingWebModule,\n            });\n        }\n        return builtFileResult;\n    }\n    function runLintAll(workerConfig) {\n        let { id, cmd, watch: watchCmd } = workerConfig;\n        const workerPromise = execa.command(watchCmd || cmd, {\n            env: npmRunPath.env(),\n            extendEnv: true,\n            shell: true,\n            cwd,\n        });\n        const { stdout, stderr } = workerPromise;\n        stdout?.on('data', (b) => {\n            let stdOutput = b.toString();\n            if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                messageBus.emit('WORKER_RESET', { id });\n                stdOutput = stdOutput.replace(/\\x1Bc/, '').replace(/\\u001bc/, '');\n            }\n            if (id.endsWith(':tsc')) {\n                if (stdOutput.includes('\\u001bc') || stdOutput.includes('\\x1Bc')) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['RUNNING', 'yellow'] });\n                }\n                if (/Watching for file changes./gm.test(stdOutput)) {\n                    messageBus.emit('WORKER_UPDATE', { id, state: 'WATCH' });\n                }\n                const errorMatch = stdOutput.match(/Found (\\d+) error/);\n                if (errorMatch && errorMatch[1] !== '0') {\n                    messageBus.emit('WORKER_UPDATE', { id, state: ['ERROR', 'red'] });\n                }\n            }\n            messageBus.emit('WORKER_MSG', { id, level: 'log', msg: stdOutput });\n        });\n        stderr?.on('data', (b) => {\n            messageBus.emit('WORKER_MSG', { id, level: 'error', msg: b.toString() });\n        });\n        workerPromise.catch((err) => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: err });\n        });\n        workerPromise.then(() => {\n            messageBus.emit('WORKER_COMPLETE', { id, error: null });\n        });\n    }\n    for (const workerConfig of config.scripts) {\n        if (workerConfig.type === 'run') {\n            runLintAll(workerConfig);\n        }\n        if (workerConfig.type === 'mount') {\n            mountedDirectories.push(getMountedDirectory(cwd, workerConfig));\n            setTimeout(() => messageBus.emit('WORKER_UPDATE', { id: workerConfig.id, state: ['DONE', 'green'] }), 400);\n        }\n    }\n    const devProxies = {};\n    config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n        const proxyServer = (devProxies[pathPrefix] = HttpProxy.createProxyServer(proxyOptions));\n        for (const [onEventName, eventHandler] of Object.entries(proxyOptions.on)) {\n            proxyServer.on(onEventName, eventHandler);\n        }\n        if (!proxyOptions.on.error) {\n            proxyServer.on('error', DEFAULT_PROXY_ERROR_HANDLER);\n        }\n    });\n    const readCredentials = async (cwd) => {\n        const [cert, key] = await Promise.all([\n            fs.readFile(path.join(cwd, 'snowpack.crt')),\n            fs.readFile(path.join(cwd, 'snowpack.key')),\n        ]);\n        return {\n            cert,\n            key,\n        };\n    };\n    let credentials;\n    if (config.devOptions.secure) {\n        try {\n            credentials = await readCredentials(cwd);\n        }\n        catch (e) {\n            console.error(colors.red(`✘ No HTTPS credentials found! Missing Files:  ${colors.bold('snowpack.crt')}, ${colors.bold('snowpack.key')}`));\n            console.log();\n            console.log('You can automatically generate credentials for your project via either:');\n            console.log();\n            console.log(`  - ${colors.cyan('devcert')}: ${colors.yellow('npx devcert-cli generate localhost')}`);\n            console.log('    https://github.com/davewasmer/devcert-cli (no install required)');\n            console.log();\n            console.log(`  - ${colors.cyan('mkcert')}: ${colors.yellow('mkcert -install && mkcert -key-file snowpack.key -cert-file snowpack.crt localhost')}`);\n            console.log('    https://github.com/FiloSottile/mkcert (install required)');\n            console.log();\n            process.exit(1);\n        }\n    }\n    async function requestHandler(req, res) {\n        const reqUrl = req.url;\n        const reqUrlHmrParam = reqUrl.includes('?mtime=') && reqUrl.split('?')[1];\n        let reqPath = decodeURI(url.parse(reqUrl).pathname);\n        const originalReqPath = reqPath;\n        let isProxyModule = false;\n        let isCssModule = false;\n        if (reqPath.endsWith('.proxy.js')) {\n            isProxyModule = true;\n            reqPath = reqPath.replace('.proxy.js', '');\n        }\n        if (reqPath.endsWith('.module.css')) {\n            isCssModule = true;\n        }\n        // const requestStart = Date.now();\n        res.on('finish', () => {\n            const { method, url } = req;\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n                messageBus.emit('SERVER_RESPONSE', {\n                    method,\n                    url,\n                    statusCode,\n                });\n            }\n        });\n        if (reqPath === `/${config.buildOptions.metaDir}/hmr.js`) {\n            sendFile(req, res, HMR_DEV_CODE, '.js');\n            return;\n        }\n        if (reqPath === `/${config.buildOptions.metaDir}/env.js`) {\n            sendFile(req, res, generateEnvModule('development'), '.js');\n            return;\n        }\n        for (const [pathPrefix] of config.proxy) {\n            if (!shouldProxy(pathPrefix, req)) {\n                continue;\n            }\n            devProxies[pathPrefix].web(req, res);\n            return;\n        }\n        const attemptedFileLoads = [];\n        function attemptLoadFile(requestedFile) {\n            if (attemptedFileLoads.includes(requestedFile)) {\n                return Promise.resolve(null);\n            }\n            attemptedFileLoads.push(requestedFile);\n            return fs\n                .stat(requestedFile)\n                .then((stat) => (stat.isFile() ? requestedFile : null))\n                .catch(() => null /* ignore */);\n        }\n        let requestedFileExt = path.parse(reqPath).ext.toLowerCase();\n        let responseFileExt = requestedFileExt;\n        let fileBuilder;\n        let isRoute = !requestedFileExt;\n        // Now that we've set isRoute properly, give `requestedFileExt` a fallback\n        requestedFileExt = requestedFileExt || '.html';\n        async function getFileFromUrl(reqPath) {\n            for (const [dirDisk, dirUrl] of mountedDirectories) {\n                let requestedFile;\n                if (dirUrl === '/') {\n                    requestedFile = path.join(dirDisk, reqPath);\n                }\n                else if (reqPath.startsWith(dirUrl)) {\n                    requestedFile = path.join(dirDisk, reqPath.replace(dirUrl, './'));\n                }\n                else {\n                    continue;\n                }\n                if (requestedFile.startsWith(commandOptions.config.installOptions.dest)) {\n                    const fileLoc = await attemptLoadFile(requestedFile);\n                    if (fileLoc) {\n                        return [fileLoc, null];\n                    }\n                }\n                if (isRoute) {\n                    let fileLoc = (await attemptLoadFile(requestedFile + '.html')) ||\n                        (await attemptLoadFile(requestedFile + 'index.html')) ||\n                        (await attemptLoadFile(requestedFile + '/index.html'));\n                    if (!fileLoc && dirUrl === '/' && config.devOptions.fallback) {\n                        const fallbackFile = path.join(dirDisk, config.devOptions.fallback);\n                        fileLoc = await attemptLoadFile(fallbackFile);\n                    }\n                    if (fileLoc) {\n                        responseFileExt = '.html';\n                        return [fileLoc, null];\n                    }\n                }\n                else {\n                    for (const workerConfig of config.scripts) {\n                        const { type, match } = workerConfig;\n                        if (type !== 'build') {\n                            continue;\n                        }\n                        for (const extMatcher of match) {\n                            if (extMatcher === requestedFileExt ||\n                                srcFileExtensionMapping[extMatcher] === requestedFileExt) {\n                                const srcFile = requestedFile.replace(requestedFileExt, extMatcher);\n                                const fileLoc = await attemptLoadFile(srcFile);\n                                if (fileLoc) {\n                                    return [fileLoc, workerConfig];\n                                }\n                            }\n                        }\n                    }\n                    const fileLoc = (await attemptLoadFile(requestedFile)) ||\n                        (await attemptLoadFile(requestedFile.replace(/\\.js$/, '.jsx'))) ||\n                        (await attemptLoadFile(requestedFile.replace(/\\.js$/, '.ts'))) ||\n                        (await attemptLoadFile(requestedFile.replace(/\\.js$/, '.tsx')));\n                    if (fileLoc) {\n                        return [fileLoc, null];\n                    }\n                }\n            }\n            return [null, null];\n        }\n        // 0. Check if the request is for a virtual sub-resource. These are populated by some\n        // builders when a file compiles to multiple files. For example, Svelte & Vue files\n        // compile to a main JS file + related CSS to import with the JS.\n        let virtualResourceResponse = inMemoryResourceCache.get(reqPath);\n        if (virtualResourceResponse) {\n            if (isProxyModule) {\n                responseFileExt = '.js';\n                virtualResourceResponse = wrapEsmProxyResponse({\n                    url: reqPath,\n                    code: virtualResourceResponse,\n                    ext: requestedFileExt,\n                    hasHmr: true,\n                    config,\n                });\n            }\n            sendFile(req, res, virtualResourceResponse, responseFileExt);\n            return;\n        }\n        const [fileLoc, selectedWorker] = await getFileFromUrl(reqPath);\n        if (isRoute) {\n            messageBus.emit('NEW_SESSION');\n        }\n        if (!fileLoc) {\n            const prefix = colors.red('  ✘ ');\n            console.error(`[404] ${reqUrl}\\n${attemptedFileLoads.map((loc) => prefix + loc).join('\\n')}`);\n            return sendError(res, 404);\n        }\n        if (selectedWorker) {\n            fileBuilder = getFileBuilderForWorker(cwd, selectedWorker, messageBus);\n        }\n        async function wrapResponse(code, cssResource) {\n            if (isRoute) {\n                code = wrapHtmlResponse({ code: code, hasHmr: isHmr, buildOptions: config.buildOptions });\n            }\n            else if (isCssModule) {\n                responseFileExt = '.js';\n                code = await wrapCssModuleResponse({\n                    url: reqPath,\n                    code,\n                    ext: requestedFileExt,\n                    hasHmr: isHmr,\n                    config,\n                });\n            }\n            else if (isProxyModule) {\n                responseFileExt = '.js';\n                code = wrapEsmProxyResponse({\n                    url: reqPath,\n                    code,\n                    ext: requestedFileExt,\n                    hasHmr: isHmr,\n                    config,\n                });\n            }\n            else if (responseFileExt === '.js') {\n                code = wrapImportMeta({ code, env: true, hmr: isHmr, config });\n            }\n            if (responseFileExt === '.js' && cssResource) {\n                code = `import './${path.basename(reqPath).replace(/.js$/, '.css.proxy.js')}';\\n` + code;\n            }\n            if (responseFileExt === '.js' && reqUrlHmrParam) {\n                code = await transformEsmImports(code, (imp) => {\n                    const importUrl = path.posix.resolve(path.posix.dirname(reqPath), imp);\n                    const node = hmrEngine.getEntry(importUrl);\n                    if (node && node.needsReplacement) {\n                        hmrEngine.markEntryForReplacement(node, false);\n                        return `${imp}?${reqUrlHmrParam}`;\n                    }\n                    return imp;\n                });\n            }\n            return code;\n        }\n        // 1. Check the hot build cache. If it's already found, then just serve it.\n        let hotCachedResponse = inMemoryBuildCache.get(fileLoc);\n        if (hotCachedResponse) {\n            hotCachedResponse = hotCachedResponse.toString(getEncodingType(requestedFileExt));\n            const wrappedResponse = await wrapResponse(hotCachedResponse, inMemoryResourceCache.get(reqPath.replace(/.js$/, '.css')));\n            sendFile(req, res, wrappedResponse, responseFileExt);\n            return;\n        }\n        // 2. Load the file from disk. We'll need it to check the cold cache or build from scratch.\n        const fileContents = await fs.readFile(fileLoc, getEncodingType(requestedFileExt));\n        // 3. Check the persistent cache. If found, serve it via a \"trust-but-verify\" strategy.\n        // Build it after sending, and if it no longer matches then assume the entire cache is suspect.\n        // In that case, clear the persistent cache and then force a live-reload of the page.\n        const cachedBuildData = !filesBeingDeleted.has(fileLoc) &&\n            (await cacache.get(BUILD_CACHE, fileLoc).catch(() => null));\n        if (cachedBuildData) {\n            const { originalFileHash, resources } = cachedBuildData.metadata;\n            const newFileHash = etag(fileContents);\n            if (originalFileHash === newFileHash) {\n                const coldCachedResponse = cachedBuildData.data;\n                inMemoryBuildCache.set(fileLoc, coldCachedResponse);\n                if (resources?.css) {\n                    inMemoryResourceCache.set(reqPath.replace(/.js$/, '.css'), resources.css);\n                }\n                // Trust...\n                const wrappedResponse = await wrapResponse(coldCachedResponse.toString(getEncodingType(requestedFileExt)), resources?.css);\n                if (responseFileExt === '.js') {\n                    const isHmrEnabled = wrappedResponse.includes('import.meta.hot');\n                    const rawImports = await scanCodeImportsExports(wrappedResponse);\n                    const resolvedImports = rawImports.map((imp) => {\n                        let spec = wrappedResponse.substring(imp.s, imp.e);\n                        if (imp.d > -1) {\n                            const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n                            spec = importSpecifierMatch[1];\n                        }\n                        return path.posix.resolve(path.posix.dirname(reqPath), spec);\n                    });\n                    hmrEngine.setEntry(originalReqPath, resolvedImports, isHmrEnabled);\n                }\n                sendFile(req, res, wrappedResponse, responseFileExt);\n                // ...but verify.\n                let checkFinalBuildResult = null;\n                let checkFinalBuildCss = null;\n                try {\n                    const checkFinalBuildAnyway = await buildFile(fileContents, fileLoc, reqPath, fileBuilder);\n                    checkFinalBuildResult = checkFinalBuildAnyway && checkFinalBuildAnyway.result;\n                    checkFinalBuildCss = checkFinalBuildAnyway && checkFinalBuildAnyway.resources?.css;\n                }\n                catch (err) {\n                    // safe to ignore, it will be surfaced later anyway\n                }\n                finally {\n                    if (checkFinalBuildCss !== resources?.css ||\n                        !checkFinalBuildResult ||\n                        !coldCachedResponse.equals(Buffer.from(checkFinalBuildResult, getEncodingType(requestedFileExt)))) {\n                        inMemoryBuildCache.clear();\n                        await cacache.rm.all(BUILD_CACHE);\n                        hmrEngine.broadcastMessage({ type: 'reload' });\n                    }\n                }\n                return;\n            }\n        }\n        // 4. Final option: build the file, serve it, and cache it.\n        let finalBuild;\n        try {\n            finalBuild = await buildFile(fileContents, fileLoc, reqPath, fileBuilder);\n        }\n        catch (err) {\n            console.error(fileLoc, err);\n        }\n        if (!finalBuild || finalBuild.result === '') {\n            return sendError(res, 500);\n        }\n        inMemoryBuildCache.set(fileLoc, Buffer.from(finalBuild.result, getEncodingType(requestedFileExt)));\n        if (finalBuild.resources?.css) {\n            inMemoryResourceCache.set(reqPath.replace(/.js$/, `.css`), finalBuild.resources.css);\n        }\n        const originalFileHash = etag(fileContents);\n        cacache.put(BUILD_CACHE, fileLoc, Buffer.from(finalBuild.result, getEncodingType(requestedFileExt)), { metadata: { originalFileHash, resources: finalBuild.resources } });\n        const wrappedResponse = await wrapResponse(finalBuild.result, finalBuild.resources?.css);\n        if (responseFileExt === '.js') {\n            const isHmrEnabled = wrappedResponse.includes('import.meta.hot');\n            const rawImports = await scanCodeImportsExports(wrappedResponse);\n            const resolvedImports = rawImports.map((imp) => {\n                let spec = wrappedResponse.substring(imp.s, imp.e);\n                if (imp.d > -1) {\n                    const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n                    spec = importSpecifierMatch[1];\n                }\n                return path.posix.resolve(path.posix.dirname(reqPath), spec);\n            });\n            hmrEngine.setEntry(originalReqPath, resolvedImports, isHmrEnabled);\n        }\n        sendFile(req, res, wrappedResponse, responseFileExt);\n    }\n    const createServer = (requestHandler) => {\n        if (credentials && config.proxy.length === 0) {\n            return http2.createSecureServer({ ...credentials, allowHTTP1: true }, requestHandler);\n        }\n        else if (credentials) {\n            return https.createServer(credentials, requestHandler);\n        }\n        return http.createServer(requestHandler);\n    };\n    const server = createServer(async (req, res) => {\n        try {\n            return await requestHandler(req, res);\n        }\n        catch (err) {\n            console.error(`[500] ${req.url}`);\n            console.error(err);\n            return sendError(res, 500);\n        }\n    })\n        .on('error', (err) => {\n        console.error(colors.red(`  ✘ Failed to start server at port ${colors.bold(port)}.`), err);\n        server.close();\n        process.exit(1);\n    })\n        .on('upgrade', (req, socket, head) => {\n        config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n            const isWebSocket = proxyOptions.ws || proxyOptions.target?.toString().startsWith('ws');\n            if (isWebSocket && shouldProxy(pathPrefix, req)) {\n                devProxies[pathPrefix].ws(req, socket, head);\n                console.log('Upgrading to WebSocket');\n            }\n        });\n    })\n        .listen(port);\n    const hmrEngine = new EsmHmrEngine({ server });\n    onProcessExit(() => {\n        hmrEngine.disconnectAllClients();\n    });\n    // Live Reload + File System Watching\n    let isLiveReloadPaused = false;\n    function updateOrBubble(url, visited) {\n        if (visited.has(url)) {\n            return;\n        }\n        visited.add(url);\n        const node = hmrEngine.getEntry(url);\n        if (node && node.isHmrEnabled) {\n            hmrEngine.broadcastMessage({ type: 'update', url });\n        }\n        if (node && node.isHmrAccepted) {\n            // Found a boundary, no bubbling needed\n        }\n        else if (node && node.dependents.size > 0) {\n            hmrEngine.markEntryForReplacement(node, true);\n            node.dependents.forEach((dep) => updateOrBubble(dep, visited));\n        }\n        else {\n            // We've reached the top, trigger a full page refresh\n            hmrEngine.broadcastMessage({ type: 'reload' });\n        }\n    }\n    function handleHmrUpdate(fileLoc) {\n        if (isLiveReloadPaused) {\n            return;\n        }\n        let updateUrl = getUrlFromFile(mountedDirectories, fileLoc);\n        if (!updateUrl) {\n            return;\n        }\n        // Append \".proxy.js\" to Non-JS files to match their registered URL in the client app.\n        if (!updateUrl.endsWith('.js') && !updateUrl.endsWith('.module.css')) {\n            updateUrl += '.proxy.js';\n        }\n        // Check if a virtual file exists in the resource cache (ex: CSS from a Svelte file)\n        // If it does, mark it for HMR replacement but DONT trigger a separate HMR update event.\n        // This is because a virtual resource doesn't actually exist on disk, so we need the main\n        // resource (the JS) to load first. Only after that happens will the CSS exist.\n        const virtualCssFileUrl = updateUrl.replace(/.js$/, '.css');\n        const virtualNode = hmrEngine.getEntry(`${virtualCssFileUrl}.proxy.js`);\n        if (virtualNode && inMemoryResourceCache.has(virtualCssFileUrl)) {\n            inMemoryResourceCache.delete(virtualCssFileUrl);\n            hmrEngine.markEntryForReplacement(virtualNode, true);\n        }\n        // If the changed file exists on the page, trigger a new HMR update.\n        if (hmrEngine.getEntry(updateUrl)) {\n            updateOrBubble(updateUrl, new Set());\n            return;\n        }\n        // Otherwise, reload the page if the file exists in our hot cache (which means that the\n        // file likely exists on the current page, but is not supported by HMR (HTML, image, etc)).\n        if (inMemoryBuildCache.has(fileLoc)) {\n            hmrEngine.broadcastMessage({ type: 'reload' });\n            return;\n        }\n    }\n    // Announce server has started\n    const ips = Object.values(os.networkInterfaces())\n        .reduce((every, i) => [...every, ...(i || [])], [])\n        .filter((i) => i.family === 'IPv4' && i.internal === false)\n        .map((i) => i.address);\n    const protocol = config.devOptions.secure ? 'https:' : 'http:';\n    messageBus.emit('SERVER_START', {\n        protocol,\n        port,\n        ips,\n        startTimeMs: Date.now() - serverStart,\n    });\n    // Open the user's browser\n    if (open !== 'none')\n        await openInBrowser(protocol, port, open);\n    // Start watching the file system.\n    // Defer \"chokidar\" loading to here, to reduce impact on overall startup time\n    const chokidar = await import('chokidar');\n    // Watch src files\n    async function onWatchEvent(fileLoc) {\n        handleHmrUpdate(fileLoc);\n        inMemoryBuildCache.delete(fileLoc);\n        filesBeingDeleted.add(fileLoc);\n        await cacache.rm.entry(BUILD_CACHE, fileLoc);\n        filesBeingDeleted.delete(fileLoc);\n    }\n    const watcher = chokidar.watch(mountedDirectories.map(([dirDisk]) => dirDisk), {\n        ignored: config.exclude,\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    watcher.on('add', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('change', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('unlink', (fileLoc) => onWatchEvent(fileLoc));\n    // Watch node_modules & rerun snowpack install if symlinked dep updates\n    const symlinkedFileLocs = new Set(Object.keys(dependencyImportMap.imports)\n        .map((specifier) => {\n        const [packageName] = parsePackageImportSpecifier(specifier);\n        return resolveDependencyManifest(packageName, cwd);\n    }) // resolve symlink src location\n        .filter(([_, packageManifest]) => packageManifest && !packageManifest['_id']) // only watch symlinked deps for now\n        .map(([fileLoc]) => `${path.dirname(fileLoc)}/**`));\n    function onDepWatchEvent() {\n        reinstallDependencies().then(() => hmrEngine.broadcastMessage({ type: 'reload' }));\n    }\n    const depWatcher = chokidar.watch([...symlinkedFileLocs], {\n        cwd: '/',\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    depWatcher.on('add', onDepWatchEvent);\n    depWatcher.on('change', onDepWatchEvent);\n    depWatcher.on('unlink', onDepWatchEvent);\n    return new Promise(() => { });\n}\n","import { promises as fs } from 'fs';\nimport got from 'got';\nimport path from 'path';\nimport { command as installCommand } from './install';\nexport async function addCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName, pkgSemver] = addValue.split('@');\n    if (!pkgSemver) {\n        const body = (await got(`http://registry.npmjs.org/${pkgName}/latest`).json());\n        pkgSemver = `^${body.version}`;\n    }\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    pkgManifest.webDependencies[pkgName] = pkgSemver;\n    config.webDependencies = config.webDependencies || {};\n    config.webDependencies[pkgName] = pkgSemver;\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\nexport async function rmCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName] = addValue.split('@');\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    delete pkgManifest.webDependencies[pkgName];\n    config.webDependencies = config.webDependencies || {};\n    delete config.webDependencies[pkgName];\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\n","import { cosmiconfigSync } from 'cosmiconfig';\nimport { all as merge } from 'deepmerge';\nimport { validate } from 'jsonschema';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport yargs from 'yargs-parser';\nimport { esbuildPlugin } from './commands/esbuildPlugin';\nimport { DEV_DEPENDENCIES_DIR } from './util';\nconst CONFIG_NAME = 'snowpack';\nconst ALWAYS_EXCLUDE = ['**/node_modules/**/*', '**/.types/**/*'];\nconst SCRIPT_TYPES_WEIGHTED = {\n    proxy: 1,\n    mount: 2,\n    run: 3,\n    build: 4,\n    bundle: 100,\n};\n// default settings\nconst DEFAULT_CONFIG = {\n    exclude: ['__tests__/**/*', '**/*.@(spec|test).*'],\n    plugins: [],\n    installOptions: {\n        dest: 'web_modules',\n        externalPackage: [],\n        installTypes: false,\n        env: {},\n        alias: {},\n        namedExports: [],\n        rollup: {\n            plugins: [],\n            dedupe: [],\n        },\n    },\n    devOptions: {\n        secure: false,\n        port: 8080,\n        open: 'default',\n        out: 'build',\n        fallback: 'index.html',\n        hmr: true,\n        bundle: undefined,\n    },\n    buildOptions: {\n        baseUrl: '/',\n        metaDir: '__snowpack__',\n    },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        extends: { type: 'string' },\n        install: { type: 'array', items: { type: 'string' } },\n        exclude: { type: 'array', items: { type: 'string' } },\n        plugins: { type: 'array' },\n        webDependencies: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        scripts: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        devOptions: {\n            type: 'object',\n            properties: {\n                secure: { type: 'boolean' },\n                port: { type: 'number' },\n                out: { type: 'string' },\n                fallback: { type: 'string' },\n                bundle: { type: 'boolean' },\n                open: { type: 'string' },\n                hmr: { type: 'boolean' },\n            },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                dest: { type: 'string' },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                treeshake: { type: 'boolean' },\n                installTypes: { type: 'boolean' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                alias: {\n                    type: 'object',\n                    additionalProperties: { type: 'string' },\n                },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n                rollup: {\n                    type: 'object',\n                    properties: {\n                        plugins: { type: 'array', items: { type: 'object' } },\n                        dedupe: {\n                            type: 'array',\n                            items: { type: 'string' },\n                        },\n                    },\n                },\n            },\n        },\n        buildOptions: {\n            type: ['object'],\n            properties: {\n                baseUrl: { type: 'string' },\n                metaDir: { type: 'string' },\n            },\n        },\n        proxy: {\n            type: 'object',\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const result = {\n        installOptions: {},\n        devOptions: {},\n        buildOptions: {},\n    };\n    const { help, version, reload, config, ...relevantFlags } = flags;\n    for (const [flag, val] of Object.entries(relevantFlags)) {\n        if (flag === '_' || flag.includes('-')) {\n            continue;\n        }\n        if (configSchema.properties[flag]) {\n            result[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.installOptions.properties[flag]) {\n            result.installOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.devOptions.properties[flag]) {\n            result.devOptions[flag] = val;\n            continue;\n        }\n        console.error(`Unknown CLI flag: \"${flag}\"`);\n        process.exit(1);\n    }\n    if (result.installOptions.env) {\n        result.installOptions.env = result.installOptions.env.reduce((acc, id) => {\n            const index = id.indexOf('=');\n            const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n            acc[key] = val;\n            return acc;\n        }, {});\n    }\n    return result;\n}\n/**\n * Convert deprecated proxy scripts to\n * FUTURE: Remove this on next major release\n */\nfunction handleLegacyProxyScripts(config) {\n    for (const scriptId in config.scripts) {\n        if (!scriptId.startsWith('proxy:')) {\n            continue;\n        }\n        const cmdArr = config.scripts[scriptId].split(/\\s+/);\n        if (cmdArr[0] !== 'proxy') {\n            handleConfigError(`scripts[${scriptId}] must use the proxy command`);\n        }\n        cmdArr.shift();\n        const { to, _ } = yargs(cmdArr);\n        if (_.length !== 1) {\n            handleConfigError(`scripts[${scriptId}] must use the format: \"proxy http://SOME.URL --to /PATH\"`);\n        }\n        if (to && to[0] !== '/') {\n            handleConfigError(`scripts[${scriptId}]: \"--to ${to}\" must be a URL path, and start with a \"/\"`);\n        }\n        const { toUrl, fromUrl } = { fromUrl: _[0], toUrl: to };\n        if (config.proxy[toUrl]) {\n            handleConfigError(`scripts[${scriptId}]: Cannot overwrite proxy[${toUrl}].`);\n        }\n        config.proxy[toUrl] = fromUrl;\n        delete config.scripts[scriptId];\n    }\n    return config;\n}\nfunction normalizeScripts(scripts) {\n    function prefixDot(file) {\n        return `.${file}`.replace(/^\\.+/, '.'); // prefix with dot, and make sure only one sticks\n    }\n    const processedScripts = [];\n    if (Object.keys(scripts).filter((k) => k.startsWith('bundle:')).length > 1) {\n        handleConfigError(`scripts can only contain 1 script of type \"bundle:\".`);\n    }\n    for (const scriptId of Object.keys(scripts)) {\n        if (scriptId.includes('::watch')) {\n            continue;\n        }\n        const [scriptType, scriptMatch] = scriptId.split(':');\n        if (!SCRIPT_TYPES_WEIGHTED[scriptType]) {\n            handleConfigError(`scripts[${scriptId}]: \"${scriptType}\" is not a known script type.`);\n        }\n        const cmd = scripts[scriptId];\n        const newScriptConfig = {\n            id: scriptId,\n            type: scriptType,\n            match: scriptMatch.split(',').map(prefixDot),\n            cmd,\n            watch: scripts[`${scriptId}::watch`],\n        };\n        if (newScriptConfig.watch) {\n            newScriptConfig.watch = newScriptConfig.watch.replace('$1', newScriptConfig.cmd);\n        }\n        if (scriptType === 'mount') {\n            const cmdArr = cmd.split(/\\s+/);\n            if (cmdArr[0] !== 'mount') {\n                handleConfigError(`scripts[${scriptId}] must use the mount command`);\n            }\n            cmdArr.shift();\n            const { to, _ } = yargs(cmdArr);\n            if (_.length !== 1) {\n                handleConfigError(`scripts[${scriptId}] must use the format: \"mount dir [--to /PATH]\"`);\n            }\n            if (to && to[0] !== '/') {\n                handleConfigError(`scripts[${scriptId}]: \"--to ${to}\" must be a URL path, and start with a \"/\"`);\n            }\n            let dirDisk = cmdArr[0];\n            const dirUrl = to || `/${cmdArr[0]}`;\n            // mount:web_modules is a special case script where the fromDisk\n            // arg is hard-coded to match the internal dependency directory.\n            if (scriptId === 'mount:web_modules') {\n                dirDisk = DEV_DEPENDENCIES_DIR;\n            }\n            newScriptConfig.args = {\n                fromDisk: path.posix.normalize(dirDisk + '/'),\n                toUrl: path.posix.normalize(dirUrl + '/'),\n            };\n        }\n        processedScripts.push(newScriptConfig);\n    }\n    const allBuildMatch = new Set();\n    for (const { type, match } of processedScripts) {\n        if (type !== 'build') {\n            continue;\n        }\n        for (const ext of match) {\n            if (allBuildMatch.has(ext)) {\n                handleConfigError(`Multiple \"scripts\" match the \"${ext}\" file extension.\\nCurrently, only one script per file type is supported.`);\n            }\n            allBuildMatch.add(prefixDot(ext));\n        }\n    }\n    if (!scripts['mount:web_modules']) {\n        processedScripts.push({\n            id: 'mount:web_modules',\n            type: 'mount',\n            match: ['web_modules'],\n            cmd: `mount $WEB_MODULES --to /web_modules`,\n            args: {\n                fromDisk: DEV_DEPENDENCIES_DIR,\n                toUrl: '/web_modules',\n            },\n        });\n    }\n    const defaultBuildMatch = ['.js', '.jsx', '.ts', '.tsx'].filter((ext) => !allBuildMatch.has(ext));\n    if (defaultBuildMatch.length > 0) {\n        const defaultBuildWorkerConfig = {\n            id: `build:${defaultBuildMatch.join(',')}`,\n            type: 'build',\n            match: defaultBuildMatch,\n            cmd: '(default) esbuild',\n            plugin: esbuildPlugin(),\n        };\n        processedScripts.push(defaultBuildWorkerConfig);\n    }\n    processedScripts.sort((a, b) => {\n        if (a.type === b.type) {\n            if (a.id === 'mount:web_modules') {\n                return -1;\n            }\n            if (b.id === 'mount:web_modules') {\n                return 1;\n            }\n            return a.id.localeCompare(b.id);\n        }\n        return SCRIPT_TYPES_WEIGHTED[a.type] - SCRIPT_TYPES_WEIGHTED[b.type];\n    });\n    return processedScripts;\n}\nfunction normalizeProxies(proxies) {\n    return Object.entries(proxies).map(([pathPrefix, options]) => {\n        if (typeof options !== 'string') {\n            return [\n                pathPrefix,\n                {\n                    //@ts-ignore - Seems to be a strange 3.9.x bug\n                    on: {},\n                    ...options,\n                },\n            ];\n        }\n        return [\n            pathPrefix,\n            {\n                on: {\n                    proxyReq: (proxyReq, req) => {\n                        const proxyPath = proxyReq.path.split(req.url)[0];\n                        proxyReq.path = proxyPath + req.url.replace(pathPrefix, '');\n                    },\n                },\n                target: options,\n                changeOrigin: true,\n                secure: false,\n            },\n        ];\n    });\n}\n/** resolve --dest relative to cwd, etc. */\nfunction normalizeConfig(config) {\n    const cwd = process.cwd();\n    config.knownEntrypoints = config.install || [];\n    config.installOptions.dest = path.resolve(cwd, config.installOptions.dest);\n    config.devOptions.out = path.resolve(cwd, config.devOptions.out);\n    config.exclude = Array.from(new Set([...ALWAYS_EXCLUDE, ...config.exclude]));\n    if (!config.scripts) {\n        config.exclude.push('**/.*');\n        config.scripts = {\n            'mount:*': 'mount . --to /',\n        };\n    }\n    if (!config.proxy) {\n        config.proxy = {};\n    }\n    const allPlugins = {};\n    // remove leading/trailing slashes\n    config.buildOptions.metaDir = config.buildOptions.metaDir\n        .replace(/^(\\/|\\\\)/g, '') // replace leading slash\n        .replace(/(\\/|\\\\)$/g, ''); // replace trailing slash\n    config.plugins = config.plugins.map((plugin) => {\n        const configPluginPath = Array.isArray(plugin) ? plugin[0] : plugin;\n        const configPluginOptions = (Array.isArray(plugin) && plugin[1]) || {};\n        const configPluginLoc = require.resolve(configPluginPath, { paths: [cwd] });\n        const configPlugin = require(configPluginLoc)(config, configPluginOptions);\n        if ((configPlugin.build ? 1 : 0) +\n            (configPlugin.transform ? 1 : 0) +\n            (configPlugin.bundle ? 1 : 0) >\n            1) {\n            handleConfigError(`plugin[${configPluginLoc}]: A valid plugin can only have one build(), transform(), or bundle() function.`);\n        }\n        allPlugins[configPluginPath] = configPlugin;\n        if (configPlugin.knownEntrypoints) {\n            config.knownEntrypoints.push(...configPlugin.knownEntrypoints);\n        }\n        if (configPlugin.defaultBuildScript &&\n            !config.scripts[configPlugin.defaultBuildScript] &&\n            !Object.values(config.scripts).includes(configPluginPath)) {\n            config.scripts[configPlugin.defaultBuildScript] = configPluginPath;\n        }\n        return configPlugin;\n    });\n    if (config.devOptions.bundle === true && !config.scripts['bundle:*']) {\n        handleConfigError(`--bundle set to true, but no \"bundle:*\" script/plugin was provided.`);\n    }\n    config = handleLegacyProxyScripts(config);\n    config.proxy = normalizeProxies(config.proxy);\n    config.scripts = normalizeScripts(config.scripts);\n    config.scripts.forEach((script) => {\n        if (script.plugin)\n            return;\n        // Ensure plugins are properly registered/configured\n        if (['build', 'bundle'].includes(script.type)) {\n            if (allPlugins[script.cmd]?.[script.type]) {\n                script.plugin = allPlugins[script.cmd];\n            }\n            else if (allPlugins[script.cmd] && !allPlugins[script.cmd][script.type]) {\n                handleConfigError(`scripts[${script.id}]: Plugin \"${script.cmd}\" has no ${script.type} script.`);\n            }\n            else if (script.cmd.startsWith('@') || script.cmd.startsWith('.')) {\n                handleConfigError(`scripts[${script.id}]: Register plugin \"${script.cmd}\" in your Snowpack \"plugins\" config.`);\n            }\n        }\n    });\n    return config;\n}\nfunction handleConfigError(msg) {\n    console.error(`[error]: ${msg}`);\n    process.exit(1);\n}\nfunction handleValidationErrors(filepath, errors) {\n    console.error(colors.red(`! ${filepath || 'Configuration error'}`));\n    console.error(errors.map((err) => `    - ${err.toString()}`).join('\\n'));\n    console.error(`    See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction handleDeprecatedConfigError(mainMsg, ...msgs) {\n    console.error(colors.red(mainMsg));\n    msgs.forEach(console.error);\n    console.error(`See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction validateConfigAgainstV1(rawConfig, cliFlags) {\n    // Moved!\n    if (rawConfig.dedupe || cliFlags.dedupe) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `dedupe` is now `installOptions.rollup.dedupe`.');\n    }\n    if (rawConfig.namedExports) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `rollup.namedExports` is no longer required. See also: installOptions.namedExports');\n    }\n    if (rawConfig.installOptions?.rollup?.namedExports) {\n        delete rawConfig.installOptions.rollup.namedExports;\n        console.error(colors.yellow('[Snowpack v2.3.0] `rollup.namedExports` is no longer required. See also: installOptions.namedExports'));\n    }\n    if (rawConfig.rollup) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] top-level `rollup` config is now `installOptions.rollup`.');\n    }\n    if (rawConfig.installOptions?.include || cliFlags.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.include` is now handled via \"mount\" build scripts!');\n    }\n    if (rawConfig.installOptions?.exclude) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.exclude` is now `exclude`.');\n    }\n    if (Array.isArray(rawConfig.webDependencies)) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] The `webDependencies` array is now `install`.');\n    }\n    if (rawConfig.knownEntrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `knownEntrypoints` is now `install`.');\n    }\n    if (rawConfig.entrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `entrypoints` is now `install`.');\n    }\n    if (rawConfig.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] All files are now included by default. \"include\" config is safe to remove.', 'Whitelist & include specific folders via \"mount\" build scripts.');\n    }\n    // Replaced!\n    if (rawConfig.source || cliFlags.source) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `source` is now detected automatically, this config is safe to remove.');\n    }\n    if (rawConfig.stat || cliFlags.stat) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `stat` is now the default output, this config is safe to remove.');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('lintall')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"lintall:...\"]` has been renamed to scripts[\"run:...\"]');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('plugin:`')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"plugin:...\"]` have been renamed to scripts[\"build:...\"].');\n    }\n    // Removed!\n    if (rawConfig.devOptions?.dist) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `devOptions.dist` is no longer required. This config is safe to remove.', `If you'd still like to host your src/ directory at the \"/_dist/*\" URL, create a mount script:',\n      '    {\"scripts\": {\"mount:src\": \"mount src --to /_dist_\"}} `);\n    }\n    if (rawConfig.hash || cliFlags.hash) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.hash` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomodule || cliFlags.nomodule) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomodule` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomoduleOutput || cliFlags.nomoduleOutput) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomoduleOutput` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.babel || cliFlags.babel) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.babel` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.optimize || cliFlags.optimize) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.optimize` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.strict || cliFlags.strict) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.strict` is no longer supported.');\n    }\n}\nexport function createConfiguration(config) {\n    const { errors: validationErrors } = validate(config, configSchema, {\n        propertyName: CONFIG_NAME,\n        allowUnknownAttributes: false,\n    });\n    if (validationErrors.length > 0) {\n        return [validationErrors, undefined];\n    }\n    const mergedConfig = merge([DEFAULT_CONFIG, config]);\n    return [null, normalizeConfig(mergedConfig)];\n}\nexport function loadAndValidateConfig(flags, pkgManifest) {\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(process.cwd(), flags.config));\n        if (!result) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    // If no config was found above, search for one.\n    result = result || explorerSync.search();\n    // If still no config found, assume none exists and use the default config.\n    if (!result || !result.config || result.isEmpty) {\n        result = { config: { ...DEFAULT_CONFIG } };\n    }\n    // validate against schema; throw helpful user if invalid\n    const config = result.config;\n    validateConfigAgainstV1(config, flags);\n    const cliConfig = expandCliFlags(flags);\n    let extendConfig = {};\n    if (config.extends) {\n        const extendConfigLoc = config.extends.startsWith('.')\n            ? path.resolve(path.dirname(result.filepath), config.extends)\n            : require.resolve(config.extends, { paths: [process.cwd()] });\n        const extendResult = explorerSync.load(extendConfigLoc);\n        if (!extendResult) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n            process.exit(1);\n        }\n        extendConfig = extendResult.config;\n        const extendValidation = validate(extendConfig, configSchema, {\n            allowUnknownAttributes: false,\n            propertyName: CONFIG_NAME,\n        });\n        if (extendValidation.errors && extendValidation.errors.length > 0) {\n            handleValidationErrors(result.filepath, extendValidation.errors);\n            process.exit(1);\n        }\n    }\n    // if valid, apply config over defaults\n    const mergedConfig = merge([\n        pkgManifest.homepage ? { buildOptions: { baseUrl: pkgManifest.homepage } } : {},\n        extendConfig,\n        { webDependencies: pkgManifest.webDependencies },\n        config,\n        cliConfig,\n    ]);\n    for (const webDependencyName of Object.keys(mergedConfig.webDependencies || {})) {\n        if (pkgManifest.dependencies && pkgManifest.dependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"dependencies\" config.`);\n        }\n        if (pkgManifest.devDependencies && pkgManifest.devDependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"devDependencies\" config.`);\n        }\n    }\n    const [validationErrors, configResult] = createConfiguration(mergedConfig);\n    if (validationErrors) {\n        handleValidationErrors(result.filepath, validationErrors);\n        process.exit(1);\n    }\n    return configResult;\n}\n","import path from 'path';\nimport * as colors from 'kleur/colors';\nimport yargs from 'yargs-parser';\nimport { command as buildCommand } from './commands/build';\nimport { command as devCommand } from './commands/dev';\nimport { addCommand, rmCommand } from './commands/add-rm';\nimport { command as installCommand } from './commands/install';\nimport { loadAndValidateConfig } from './config.js';\nimport { readLockfile, clearCache } from './util.js';\nexport { createConfiguration } from './config.js';\nexport { install as unstable_installCommand } from './commands/install';\nconst cwd = process.cwd();\nfunction printHelp() {\n    console.log(`\n${colors.bold(`snowpack`)} - A faster build system for the modern web.\n\n  Snowpack is best configured via config file.\n  But, most configuration can also be passed via CLI flags.\n  📖 ${colors.dim('https://www.snowpack.dev/#configuration')}\n\n${colors.bold('Commands:')}\n  snowpack dev          Develop your app locally.\n  snowpack build        Build your app for production.\n  snowpack install      (Advanced) Install web-ready dependencies.\n\n${colors.bold('Flags:')}\n  --config [path]       Set the location of your project config file.\n  --help                Show this help message.\n  --version             Show the current version.\n  --reload              Clear Snowpack's local cache (troubleshooting).\n    `.trim());\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, {\n        array: ['install', 'env', 'exclude', 'externalPackage'],\n    });\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.version) {\n        console.log(require('../package.json').version);\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(colors.yellow('! clearing cache...'));\n        await clearCache();\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(colors.red('[ERROR] package.json required but no file was found.'));\n        process.exit(1);\n    }\n    const cmd = cliFlags['_'][2];\n    // Set this early -- before config loading -- so that plugins see it.\n    if (cmd === 'build') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'production';\n    }\n    if (cmd === 'dev') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'development';\n    }\n    const commandOptions = {\n        cwd,\n        config: loadAndValidateConfig(cliFlags, pkgManifest),\n        lockfile: await readLockfile(cwd),\n        pkgManifest,\n    };\n    if (cmd === 'add') {\n        await addCommand(cliFlags['_'][3], commandOptions);\n        return;\n    }\n    if (cmd === 'rm') {\n        await rmCommand(cliFlags['_'][3], commandOptions);\n        return;\n    }\n    if (cliFlags['_'].length > 3) {\n        console.log(`Unexpected multiple commands`);\n        process.exit(1);\n    }\n    if (cmd === 'build') {\n        await buildCommand(commandOptions);\n        return;\n    }\n    if (cmd === 'dev') {\n        await devCommand(commandOptions);\n        return;\n    }\n    if (cmd === 'install' || !cmd) {\n        await installCommand(commandOptions);\n        return;\n    }\n    console.log(`Unrecognized command: ${cmd}`);\n    process.exit(1);\n}\n"],"names":["PIKA_CDN","GLOBAL_CACHE_DIR","globalCacheDir","RESOURCE_CACHE","path","join","BUILD_CACHE","PROJECT_CACHE_DIR","projectCacheDir","name","DEV_DEPENDENCIES_DIR","LOCKFILE_HASH_FILE","HAS_CDN_HASH_REGEX","HTML_JS_REGEX","isYarn","cwd","fs","existsSync","readLockfile","lockfileContents","readFileSync","encoding","err","JSON","parse","writeLockfile","loc","importMap","sortedImportMap","imports","key","Object","keys","sort","writeFileSync","stringify","undefined","fetchCDNResource","resourceUrl","responseType","startsWith","got","headers","throwHttpErrors","isTruthy","item","Boolean","parsePackageImportSpecifier","imp","impParts","split","scope","rest","resolveDependencyManifest","dep","depManifest","require","resolve","paths","code","result","fullPath","searchPath","sep","replace","indexOfSearch","lastIndexOf","manifestPath","substring","length","manifestStr","MISSING_PLUGIN_SUGGESTIONS","appNames","win32","brave","chrome","darwin","linux","openInBrowser","protocol","port","browser","url","test","process","platform","execa","command","shell","encodeURI","__dirname","stdio","open","app","checkLockfileHash","dir","lockfileLoc","findUp","hashLoc","newLockHash","etag","promises","readFile","oldLockHash","catch","updateLockfileHash","mkdirp","dirname","writeFile","clearCache","Promise","all","cacache","rm","rimraf","sync","findMatchingMountScript","scripts","spec","filter","script","type","find","args","fromDisk","getExt","fileName","baseExt","extname","toLocaleLowerCase","expandedExt","basename","spliceString","source","withSlice","start","end","slice","scanCodeImportsExports","d","importStatement","s","e","importSpecifierMatch","match","transformEsmImports","_code","replaceImport","rewrittenCode","reverse","rewrittenImport","transformHtmlImports","importRegex","RegExp","exec","scriptTag","scriptCode","trim","index","transformFileImports","Error","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","localeCompare","formatSize","size","kb","Math","round","floor","color","colors","padEnd","formatDelta","delta","formatFileInfo","filename","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","gzip","brotliStat","brotli","lineStat","lineDelta","formatFiles","files","strippedFiles","map","printStats","dependencyStats","output","direct","common","allDirect","entries","allCommon","maxFileNameLength","reduce","max","values","IS_PREACT","checkIsPreact","filePath","contents","endsWith","wrapImportMeta","hmr","env","config","buildOptions","includes","metaDir","_cssModuleLoader","wrapCssModuleResponse","hasHmr","injectableSource","exportTokens","load","wrapHtmlResponse","wrapEsmProxyResponse","ext","getFileBuilderForWorker","selectedWorker","messageBus","id","cmd","plugin","build","buildFn","emit","level","msg","message","state","cmdWithFile","stdout","stderr","npmRunPath","extendEnv","input","PUBLIC_ENV_REGEX","generateEnvModule","mode","envObject","MODE","NODE_ENV","esbuildService","esbuildPlugin","startService","isPreact","js","warnings","transform","loader","substr","jsxFactory","jsxFragment","warning","console","error","text","stopEsbuild","stop","URL_HAS_PROTOCOL_REGEX","getImportStats","dirLoc","importedFileOnDisk","statSync","resolveSourceSpecifier","isBundled","isDirectory","trailingSlash","extToReplace","srcFileExtensionMapping","createImportResolver","fileLoc","webModulesPath","dependencyImportMap","isDev","importResolver","mountScript","toUrl","importStats","protocolMatch","baseUrl","resolvedImport","posix","extName","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","validatePackageName","validForNewPackages","installUrl","installUrlType","warn","cachedResult","get","info","metadata","pinnedUrl","statusCode","body","importUrlPath","pinnedUrlPath","buildStatus","typesUrlPath","typesUrl","put","log","lookupStatusCode","resolveTargetsFromRemoteCDN","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","installSemver","webDependencies","add","resolvedUrl","onIdle","rollupPluginCatchUnresolved","resolveId","importer","isNodeBuiltin","FETCH_POLYFILL","rollupPluginCatchFetch","getInjectorCode","rollupPluginCss","skipSelf","then","resolved","humanReadableName","IS_DEEP_PACKAGE_IMPORT","rollupPluginEntrypointAlias","packageScope","packageName","packageFullName","manifest","_manifest","needsAlias","module","main","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","installTypes","allTypesToInstall","Set","cacheKey","response","finalResult","typesTarballUrl","data","toString","writeBundle","options","tempDir","tmp","mkdir","tarballContents","cachedTarball","tarballResponse","typesUrlParts","pathname","typesPackageName","typesPackageTarLoc","typesPackageLoc","tar","x","file","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","buildExistingFileCache","bundle","compareDependencies","byteLength","zlib","gzipSync","brotliCompressSync","generateBundle","_","directDependencies","commonDependencies","assetOrChunk","raw","Buffer","isBuffer","from","push","autoDetectExports","rollupPluginWrapInstallTargets","isTreeshake","autoDetectPackageExports","installTargets","installTargetsByFile","isAutoDetect","normalizedFileLoc","some","p","inputOptions","val","specifier","namespace","treeshakeSummary","summary","default","named","uniqueNamedImports","Array","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","ESM_IMPORT_REGEX","ESM_DYNAMIC_IMPORT_REGEX","HAS_NAMED_IMPORTS_REGEX","SPLIT_NAMED_IMPORTS_REGEX","DEFAULT_IMPORT_REGEX","stripJsExtension","createInstallTarget","removeSpecifierQueryString","queryStringIndex","indexOf","getWebModuleSpecifierFromCode","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","ss","se","isDynamicImport","hasDefaultImport","hasNamespaceImport","namedImports","cleanCodeForParsing","stripComments","allMatches","dynamicImportRegex","full","parseCodeForInstallTargets","locOnDisk","allImports","scanDepList","depList","whitelistItem","glob","hasMagic","nodeModulesLoc","nodePath","nodir","flat","concat","scanImports","initESModuleLexer","includeFileSets","dirDisk","ignore","exclude","absolute","includeFiles","apply","loadedFiles","regex","mime","lookup","relative","scanImportsFromFiles","target","impA","impB","ErrorWithHint","constructor","hint","CJS_PACKAGES_TO_AUTO_DETECT","banner","spinner","spinnerHasError","installResults","defaultLogError","stopAndPersist","symbol","ora","fail","defaultLogUpdate","formatInstallResults","isImportOfPackage","importUrl","getWebDependencyName","getRollupReplaceKeys","acc","resolveWebDependency","isJSFile","packageEntrypoint","packageManifestLoc","packageManifest","exports","exportMapEntry","exportMapValue","import","depManifestLoc","maybeLoc","foundEntrypoint","isImplicitEntrypoint","types","typings","FAILED_INSTALL_RETURN","success","install","logError","logUpdate","installOptions","dest","destLoc","externalPackage","externalPackages","alias","installAlias","sourceMap","rollup","userDefinedRollup","treeshake","nodeModulesInstalled","versions","pnp","allInstallSpecifiers","installEntrypoints","assetEntrypoints","installTargetsMap","autoDetectNamedExports","namedExports","targetName","targetType","targetLoc","value","forEach","t","setTimeout","isCircularImportFound","external","moduleSideEffects","plugins","rollupPluginReplace","rollupPluginAlias","mod","replacement","rollupPluginNodeResolve","mainFields","extensions","preferBuiltins","dedupe","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","externalEsm","EXTERNAL_ESM_PACKAGES","onwarn","outputOptions","format","sourcemap","chunkFileNames","packageBundle","write","_err","errFilePath","failedExtension","suggestion","assetName","assetLoc","copyFileSync","getInstallTargets","scannedFiles","knownEntrypoints","commandOptions","run","hasError","exit","startTime","Date","now","succeed","toFixed","getPort","defaultPort","bestAvailablePort","detectPort","useNextPort","isTTY","rl","readline","createInterface","stdin","question","answer","close","getStateString","workerState","isWatch","isArray","done","watch","WORKER_BASE_STATE","paint","bus","registeredWorkers","buildMode","devMode","startTimeMs","ips","consoleOutput","installOutput","isInstalling","hasBeenCleared","missingWebModule","allWorkerStates","repaint","isServerStarted","ip","dotLength","dots","fmt","stateString","spacer","cmdMsg","cmdStr","pkgName","colorsFn","overallStatus","on","util","emitKeypressEvents","addPackage","installOptimizedDependencies","allFilesToResolveImports","installDest","installConfig","merge","installResult","installRunner","EventEmitter","relevantWorkers","allBuildExtensions","workerConfig","bundleWorker","installWorker","isBundledHardcoded","devOptions","buildDirectoryLoc","out","internalFilesBuildLoc","finalDirectoryLoc","relDest","workerPromise","b","stdOutput","errorMatch","mountDirDetails","scriptConfig","dirDest","allFiles","dot","allBuildNeededFiles","f","outPath","copyFile","allBuiltFromFiles","inputExt","fileContents","fileBuilder","outLoc","builtFile","resources","urlPath","css","cssOutPath","recursive","allProxiedFiles","resolveImportSpecifier","resolvedCode","resolvedImportUrl","proxiedFileLoc","proxiedCode","proxiedExt","proxiedUrl","proxyCode","proxyFileLoc","srcDirectory","destDirectory","jsFilePaths","EsmHmrEngine","clients","dependencyTree","Map","wss","server","WebSocket","Server","noServer","req","socket","head","handleUpgrade","client","connectClient","registerListener","entry","getEntry","isHmrAccepted","isHmrEnabled","createEntry","sourceUrl","newEntry","dependencies","dependents","needsReplacement","set","createIfNotFound","setEntry","outdatedDependencies","addRelationship","delete","removeRelationship","importResult","sourceResult","markEntryForReplacement","broadcastMessage","readyState","OPEN","send","disconnectClient","terminate","disconnectAllClients","HMR_DEV_CODE","DEFAULT_PROXY_ERROR_HANDLER","res","reqUrl","sendError","shouldProxy","pathPrefix","reqPath","decodeURI","getEncodingType","sendFile","ETag","weak","contentType","Vary","writeHead","acceptEncoding","method","isCompressible","onError","stream","Readable","bodyStream","pipeline","createGzip","status","getUrlFromFile","mountedDirectories","dirUrl","resolvedDirUrl","getMountedDirectory","currentlyRunningCommand","isHmr","serverStart","inMemoryBuildCache","inMemoryResourceCache","filesBeingDeleted","filesBeingBuilt","isLiveReloadPaused","installCommand","installCommandOptions","clear","dependencyImportMapLoc","reinstallDependencies","buildFile","builtFileResult","fileBuilderPromise","_builtFileResult","webModulesScript","doesPackageExist","runLintAll","watchCmd","devProxies","proxy","proxyOptions","proxyServer","HttpProxy","createProxyServer","onEventName","eventHandler","readCredentials","cert","credentials","secure","requestHandler","reqUrlHmrParam","originalReqPath","isProxyModule","isCssModule","web","attemptedFileLoads","attemptLoadFile","requestedFile","stat","isFile","requestedFileExt","toLowerCase","responseFileExt","isRoute","getFileFromUrl","fallback","fallbackFile","extMatcher","srcFile","virtualResourceResponse","prefix","wrapResponse","cssResource","node","hmrEngine","hotCachedResponse","wrappedResponse","cachedBuildData","has","originalFileHash","newFileHash","coldCachedResponse","rawImports","resolvedImports","checkFinalBuildResult","checkFinalBuildCss","checkFinalBuildAnyway","equals","finalBuild","createServer","http2","createSecureServer","allowHTTP1","https","http","isWebSocket","ws","listen","onProcessExit","updateOrBubble","visited","handleHmrUpdate","updateUrl","virtualCssFileUrl","virtualNode","os","networkInterfaces","every","i","family","internal","address","chokidar","onWatchEvent","watcher","ignored","persistent","ignoreInitial","disableGlobbing","symlinkedFileLocs","onDepWatchEvent","depWatcher","addCommand","addValue","pkgManifest","pkgSemver","json","version","rmCommand","CONFIG_NAME","ALWAYS_EXCLUDE","SCRIPT_TYPES_WEIGHTED","mount","DEFAULT_CONFIG","configSchema","properties","extends","items","additionalProperties","oneOf","enum","expandCliFlags","flags","relevantFlags","flag","handleLegacyProxyScripts","scriptId","cmdArr","handleConfigError","shift","to","yargs","fromUrl","normalizeScripts","prefixDot","processedScripts","k","scriptType","scriptMatch","newScriptConfig","normalize","allBuildMatch","defaultBuildMatch","defaultBuildWorkerConfig","a","normalizeProxies","proxies","proxyReq","proxyPath","changeOrigin","normalizeConfig","allPlugins","configPluginPath","configPluginOptions","configPluginLoc","configPlugin","defaultBuildScript","handleValidationErrors","filepath","errors","handleDeprecatedConfigError","mainMsg","msgs","validateConfigAgainstV1","rawConfig","cliFlags","include","entrypoints","dist","hash","nomodule","nomoduleOutput","babel","optimize","strict","createConfiguration","validationErrors","validate","propertyName","allowUnknownAttributes","mergedConfig","loadAndValidateConfig","explorerSync","cosmiconfigSync","searchPlaces","stopDir","search","isEmpty","cliConfig","extendConfig","extendConfigLoc","extendResult","extendValidation","homepage","webDependencyName","devDependencies","configResult","printHelp","cli","array","help","reload","buildCommand","devCommand"],"mappings":"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"}